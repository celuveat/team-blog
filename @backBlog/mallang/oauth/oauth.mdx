---
date: 2023-07-31
authors: shin-mallang
title: "OAuth2.0 ë„ì…ê¸°"
description: "OAuth2.0 ë„ì…ê¸°"
keywords: ["OAuth2.0", "ì†Œì…œ ë¡œê·¸ì¸"]
tags:
  - OAuth2.0
  - ì†Œì…œ ë¡œê·¸ì¸
---

OAuth2.0 ë„ì…ê¸°

<!--truncate-->

<br />
<br />

> ì´ ê¸€ì€ ë°±ì—”ë“œ í¬ë£¨ ë§ë‘ì´ê°€ ì‘ì„±í–ˆê¸° ë•Œë¬¸ì—, í”„ë¡ íŠ¸ ì½”ë“œëŠ” ë‹¤ì†Œ ì—‰ë§ì§„ì°½ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />
<br />

OAuth2.0ì˜ ê°œë…ì— ëŒ€í•´ì„œëŠ” ì´ë¯¸ ë§ì€ ë¸”ë¡œê·¸ë“¤ì—ì„œ ë‹¤ë£¨ê³  ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ ê¸€ì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•ŠìŒì„ ë¨¼ì € ë°í™ë‹ˆë‹¤.

í•´ë‹¹ ê¸€ì—ì„œëŠ” (ì ì–´ë„ ì œê°€ ì‚´í´ë³´ì•˜ë˜) ëŒ€ë¶€ë¶„ì˜ ë¸”ë¡œê·¸ì—ì„œ ì• ë§¤í•˜ê²Œ ì„¤ëª…ë˜ì–´ìˆëŠ” **í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œì˜ ì—­í• **ê³¼, ì´ë¥¼ ì‹¤ì œë¡œ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ì§€ë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ë‹¤ë£° ê²ƒì…ë‹ˆë‹¤.

ë˜í•œ ë‹¨ìˆœíˆ êµ¬í˜„í•˜ê³  ëë‚´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìƒˆë¡œìš´ íƒ€ì‚¬ í”Œë«í¼ì„ ì¶”ê°€í•˜ëŠ” ê³¼ì •ë„ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ **ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°**ë¥¼ ê°€ì§„ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì†ŒìŠ¤ ì½”ë“œëŠ” [í•´ë‹¹ Repository](https://github.com/shin-mallang/oauth-login-sample) ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />
<br />

## ğŸ§ OAuth 2.0 í”Œë¡œìš° ì •ë¦¬

ì²˜ìŒ OAuth 2.0ì„ ì ‘í•˜ê³  ê³µë¶€í•˜ë‹¤ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê·¸ë¦¼ê³¼ ì„¤ëª…ì„ í”í•˜ê²Œ ë§ˆì£¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![OAuth2-flow](./oauth-flow.png)

ìœ„ ì„¤ëª…ì€ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œì˜ ì—­í• ì´ ë¶ˆë¶„ëª…í•˜ë‹¤ëŠ” ë¬¸ì œì ì´ ìˆìŠµë‹ˆë‹¤.

ìœ„ ê°œë…ì„ ì²˜ìŒ ì ‘í•˜ê³  êµ¬í˜„í•˜ë ¤ëŠ” ì‚¬ëŒë“¤ì„ ëŒ€ë¶€ë¶„ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìì™€ ë°±ì—”ë“œ ê°œë°œìì¼í…ë°, ì´ë“¤ì˜ ì—­í• ì€ ì–´ë–»ê²Œ êµ¬ë¶„ë˜ì–´ì§ˆê¹Œìš”?

OAuth2.0 ì— ëŒ€í•´ ì„¤ëª…í•˜ëŠ” ê¸€ë“¤ì„ ì°¾ì•„ë³´ë©´, ì´ë“¤ì˜ ì—­í• ì„ ë‹¨ìˆœíˆ Clientë¡œë§Œ ë­‰ëš±ê·¸ë ¤ ì„¤ëª…í•˜ëŠ” ê¸€ë“¤ì´ ëŒ€ë¶€ë¶„ì´ì—ˆìŠµë‹ˆë‹¤.

ì´ëŸ¬ë©´ ì €ê°™ì€ ë°”ë³´ ê°œë°œì ì…ì¥ì—ì„œëŠ” êµ¬í˜„í•˜ê¸°ê°€ ì‰½ì§€ ì•Šê² ì£ ... ğŸ˜¢

ê·¸ë˜ì„œ ì €ëŠ” í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìì™€ ë°±ì—”ë“œ ê°œë°œìì˜ ì—­í• ì„ ì¡°ê¸ˆ ë” êµ¬ë¶„ì§€ì–´ Clientì˜ ì—­í• ì— ì§‘ì¤‘í•˜ê³ ì í•©ë‹ˆë‹¤.

<br />
<br />
<br />
<br />

## ğŸ§ êµ¬í˜„í•˜ëŠ” ë°©ë²•

OAuth2.0 ì„ í†µí•œ ë¡œê·¸ì¸ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ **Redirect URI**ë¥¼ **ë°±ì—”ë“œ**ë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ê³¼ **í”„ë¡ íŠ¸ì—”ë“œ**ë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

ê°ê°ì˜ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í–ˆì„ ë•Œ ì¥ì ê³¼ í•œê³„ì ì— ëŒ€í•´ ì„¤ëª…í•˜ê³ , ì´ë“¤ ì¤‘ **í”„ë¡ íŠ¸ì—”ë“œ**ë¡œ Redirect URIë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

(ì´ë•Œ ëª¨ë“  ìƒí™©ì—ì„œ íšŒì›ê°€ì… & ë¡œê·¸ì¸ì„ í•œë‹¤ëŠ” ê°€ì •ì„ í†µí•´ ì¥ì ê³¼ ë‹¨ì ì„ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. íšŒì›ê°€ì… í”Œë¡œìš°ëŠ” ìœ„ ê·¸ë¦¼ê³¼ ë™ì¼í•©ë‹ˆë‹¤.)

<br />
<br />
<br />

### ğŸ³ Redirect URIë¥¼ ë°±ì—”ë“œë¡œ ì„¤ì •í•˜ê¸°

í° íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> 1\. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
>
> 2\. (ë²„íŠ¼ì„ ëˆ„ë¥´ë©´) í”„ë¡ íŠ¸ì—”ë“œëŠ” ë°±ì—”ë“œì˜ íŠ¹ì • URIë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
>
> 3\. ë°±ì—”ë“œëŠ” ì´ë¥¼ ì²˜ë¦¬í•˜ì—¬ cliend_id, redirect_uri ë“±ì„ í¬í•¨í•˜ì—¬ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„(Authorization Server)ì˜ Auth Code ë°œê¸‰ URLë¡œ Redirect ì‹œí‚¨ë‹¤.
> ì´ë ‡ê²Œ ë˜ë©´ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ì—ì„œ ì‚¬ìš©ìì—ê²Œ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì œê³µí•œë‹¤.
>
> 4\. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ê³ , ì •ë³´ ì‚¬ìš©ì— ë™ì˜í•œë‹¤.
>
> 5\. í•´ë‹¹ ì •ë³´ëŠ” Authorization Serverì— ì „ë‹¬ë˜ë©°, ì´í›„ ì‚¬ì „ì— ë“±ë¡í•œ ë°±ì—”ë“œì˜ Redirect URIë¡œ Auth Codeì™€ í•¨ê»˜ Redirected ëœë‹¤.
>
> 6\. ë°±ì—”ë“œëŠ” @GetMapping ë“±ìœ¼ë¡œ Redirect URIë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ë„ë¡ êµ¬í˜„í•œë‹¤.
>
> - ìš”ì²­ì˜ Query Stringìœ¼ë¡œë¶€í„° Codeë¥¼ ì¶”ì¶œí•œë‹¤.
> - í•´ë‹¹ Codeë¥¼ ê°€ì§€ê³  AccessTokenì„ ë°›ì•„ì˜¨ë‹¤.
> - í•´ë‹¹ AccessTokenì„ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ì•„ì™€ íšŒì›ê°€ì…&ë¡œê·¸ì¸ ì‹œí‚¨ë‹¤.
> - ë¡œê·¸ì¸ ì´í›„ ë°œê¸‰ëœ ì¸ì¦ ì •ë³´(session í˜¹ì€ token)ì„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œì˜ ë¡œê·¸ì¸ ì„±ê³µì„ ì²˜ë¦¬í•˜ëŠ” URLë¡œ Redirect ì‹œí‚¨ë‹¤.

Redirect URIë¥¼ ë°±ì—”ë“œë¡œ ì„¤ì •í•˜ë©´, í”„ë¡ íŠ¸ëŠ” ì•„ë¬´ëŸ° ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

ë°±ì—”ë“œ ë‚´ë¶€ì—ì„œ Auth Codeë¥¼ í†µí•´ AccessTokenì„ ê°€ì ¸ì˜¤ê³ , ì´ì–´ì„œ AccessTokenì„ í†µí•´ ì‚¬ìš©ìì˜ ì •ë³´ê¹Œì§€ ê°€ì ¸ì˜¨ ë’¤ íšŒì›ê°€ì… & ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ë¡œê·¸ì¸ ì„±ê³µ ì´í›„ Headerë‚˜ Bodyì— token ë“±ì˜ ì •ë³´ë¥¼ ë„£ì–´ì£¼ëŠ” ê²½ìš° CORS ë¬¸ì œê°€ ë°œìƒí•˜ì—¬ ì „ë‹¬í•  ìˆ˜ ì—†ëŠ” ìƒí™©ì´ ë°œìƒí•©ë‹ˆë‹¤.

![CORS ë°œìƒ í™”ë©´](./cors.png)

ê·¸ë˜ì„œ ì´ ê²½ìš°, íšŒì›ê°€ì… í˜¹ì€ ë¡œê·¸ì¸ ì²˜ë¦¬ ì™„ë£Œ ì‹œ ìƒì„±ë˜ëŠ” ì¸ì¦ ì •ë³´(JWT í˜¹ì€ ì„¸ì…˜ ë“±)ì„ í”„ë¡ íŠ¸ì—”ë“œì— ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì˜¤ì§ Query Stringì„ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ë°–ì— ì—†ìŠµë‹ˆë‹¤.

> \[ë¡œê·¸ì¸ ì´í›„ Redirectí•  í”„ë¡ íŠ¸ì—”ë“œ URL\]?accessToken={ë¡œê·¸ì¸ í›„ ë°œê¸‰í•œ ì•¡ì„¸ìŠ¤ í† í°(or ì„¸ì…˜ ID)}

ë” í° ë¬¸ì œì ì€ Redirectë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•ˆë“œë¡œì´ë“œì™€ ê°™ì€ ëª¨ë°”ì¼ í™˜ê²½ì˜ ê²½ìš° ì´ ë°©ë²•ìœ¼ë¡œëŠ” íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ì„ ì§„í–‰í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì´ëŸ¬í•œ ê²½ìš°ë¼ë©´ ë°˜ë“œì‹œ Redirect URIë¥¼ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì„¤ì •í•˜ê³  ì²˜ë¦¬í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.

ì¦‰ ì´ ë°©ë²•ì˜ íŠ¹ì§•ì„ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- ì¸ì¦ ì •ë³´(í† í°, ì„¸ì…˜)ì„ Query Stringìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ë°–ì— ì—†ë‹¤.
- ì•ˆë“œë¡œì´ë“œì™€ ê°™ì´ Redirect í•  ìˆ˜ ì—†ëŠ” ëª¨ë°”ì¼ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

ì´ì œ Redirect URIë¥¼ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ Redirect URIë¥¼ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì„¤ì •í•˜ê¸°

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ëŠ” í”Œë¡œìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> 1\. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
>
> 2\. (ë²„íŠ¼ì„ ëˆ„ë¥´ë©´) í”„ë¡ íŠ¸ì—”ë“œëŠ” ë°±ì—”ë“œì˜ íŠ¹ì • URIë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
>
> 3\. ë°±ì—”ë“œëŠ” ì´ë¥¼ ì²˜ë¦¬í•˜ì—¬ cliend_id, redirect_uri ë“±ì„ í¬í•¨í•˜ì—¬ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„(Authorization Server)ì˜ Auth Code ë°œê¸‰ URLë¡œÂ  Redirect ì‹œí‚¨ë‹¤.Â 
> ì´ë ‡ê²Œ ë˜ë©´ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ì—ì„œ ì‚¬ìš©ìì—ê²Œ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì œê³µí•œë‹¤.
>
> 4\. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ê³ , ì •ë³´ ì‚¬ìš©ì— ë™ì˜í•œë‹¤. --- ì—¬ê¸°ê¹Œì§€ ë™ì¼
>
> 5\. í•´ë‹¹ ì •ë³´ëŠ” Authorization Serverì— ì „ë‹¬ë˜ë©°, ì´í›„ ì‚¬ì „ì— ë“±ë¡í•œ **í”„ë¡ íŠ¸ì—”ë“œ**ì˜ Redirect URIë¡œ Auth Codeì™€ í•¨ê»˜ Redirected ëœë‹¤.
>
> 6\. í”„ë¡ ë“œì—”ë“œëŠ” í•´ë‹¹ Redirect URIë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, Query Stringì—ì„œ codeë¥¼ ì¶”ì¶œí•˜ì—¬ ë°±ì—”ë“œì˜ codeë¥¼ í†µí•´ íšŒì›ê°€ì… & ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ëŠ” APIë¡œ ìš”ì²­ì„ ì „ì†¡í•œë‹¤.
>
> 7\. ë°±ì—”ë“œëŠ” @PostMapping(Getë„ ìƒê´€ì—†ê³  ë­ ì•„ë¬´íŠ¼) ë“±ìœ¼ë¡œ í•´ë‹¹ ìš”ì²­ì„ ì²˜ë¦¬(codeë¥¼ í†µí•´ íšŒì›ê°€ì… & ë¡œê·¸ì¸)í•œë‹¤.
>
> - ìš”ì²­ì˜ Query Stringìœ¼ë¡œë¶€í„° Codeë¥¼ ì¶”ì¶œí•œë‹¤.
> - í•´ë‹¹ Codeë¥¼ ê°€ì§€ê³  AccessTokenì„ ë°›ì•„ì˜¨ë‹¤.
> - í•´ë‹¹ AccessTokenì„ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ì•„ì™€ íšŒì›ê°€ì…&ë¡œê·¸ì¸ ì‹œí‚¨ë‹¤.
> - ë¡œê·¸ì¸ ì´í›„ ë°œê¸‰ëœ ì¸ì¦ ì •ë³´(session í˜¹ì€ token)ì„ Header, Cookie, Body ë“±ì— ë‹´ì— í”„ë¡ íŠ¸ì—”ë“œì— ë°˜í™˜í•œë‹¤.

<br />

ìœ„ ë°©ë²•ì€ Redirect URIë¥¼ ë°±ì—”ë“œë¡œ ì„¤ì •í–ˆì„ ë•Œì˜ ë‹¨ì ì„ ëª¨ë‘ í•´ê²°í•©ë‹ˆë‹¤.

ì¦‰ ì´ ë°©ë²•ì˜ íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- ì¸ì¦ ì •ë³´(í† í°, ì„¸ì…˜)ì„ ì—¬ëŸ¬ ë°©ë²•(Query String, Header, Body)ìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
- ì•ˆë“œë¡œì´ë“œì™€ ê°™ì´ Redirect í•  ìˆ˜ ì—†ëŠ” ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì´ì œë¶€í„° í•´ë‹¹ ë°©ë²•ì„ í†µí•´ íšŒì›ê°€ì… & ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ìš°ì„  ì œì¼ ì‰¬ìš´ ì¹´ì¹´ì˜¤ë¶€í„° ì‹œì‘í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />
<br />

## ğŸ§ ì¹´ì¹´ì˜¤ Developersì— ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡

Kakao Developers([https://developers.kakao.com/](https://developers.kakao.com/))ì— ì ‘ì†í•©ë‹ˆë‹¤.

![kakao1](./kakao1.png)

**ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜**ì„ í´ë¦­í•©ë‹ˆë‹¤.

<br />
<br />
<br />

![kakao2](./kakao2.png)

**ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€í•˜ê¸°**ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

<br />
<br />
<br />

![kakao3](./kakao3.png)

**ì•± ì´ë¦„**ê³¼ **ì‚¬ì—…ìëª…**ì„ ì…ë ¥í•©ë‹ˆë‹¤.

<br />
<br />
<br />

![kakao4](./kakao4.png)

**ì•± ì„¤ì •** - **ìš”ì•½ ì •ë³´** í™”ë©´ì— ë³´ì´ëŠ” **REST API** **í‚¤** ë¥¼ ì–´ë””ì—”ê°€ ì ì–´ë‘ì„¸ìš”!

í•´ë‹¹ í‚¤ë¥¼ **client_id**ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

ì €ëŠ” ì´ì œë¶€í„° ì´ë¥¼ **mallang-kakao-client-id** ë¡œ ê°€ì •í•˜ê³  ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

(ìƒê°í•´ë³´ë‹ˆ ì–´ì°¨í”¼ ë…¸ì¶œë˜ëŠ” ê°’ì´ë¼ êµ³ì´ ê°€ë¦´ í•„ìš”ëŠ” ì—†ì—ˆë„¤ìš©..)

<br />
<br />
<br />

![kakao5](./kakao5.png)

**ì œí’ˆ ì„¤ì •** - **ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸**ìœ¼ë¡œ ì´ë™í•˜ì—¬ **í™œì„±í™” ìƒíƒœ**ë¥¼ OFF ì—ì„œ **ON**ìœ¼ë¡œ ë°”ê¿”ì¤ë‹ˆë‹¤.

ì´í›„ **Redirect URI ë“±ë¡** ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.

<br />
<br />
<br />

![kakao6](./kakao6.png)

Redirect URIë¥¼ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì„¤ì •í•  ê²ƒì´ë¯€ë¡œ, auth codeë¥¼ í†µí•´ ë°±ì—”ë“œë¡œ ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚¼ **í”„ë¡ íŠ¸ì—”ë“œ**ì˜ **URI**ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.

ê·¸ëƒ¥ ì € ë”°ë¼ **http://localhost:3000/oauth/redirected/kakao** ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´, ì•ìœ¼ë¡œ ì½”ë“œ ì§„í–‰ì„ ë”°ë¼ì˜¤ëŠ” ê²ƒì— ìˆì–´ì„œ ì œì¼ ì‰½ê¸° ë•Œë¬¸ì—, ì¼ë‹¨ ë”°ë¼ í•˜ì‹œëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

<br />
<br />
<br />

![kakao7](./kakao7.png)

**ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸** - **ë³´ì•ˆ**ìœ¼ë¡œ ì´ë™í•˜ì—¬ **Client Secret**ì„ ìƒì„±í•´ì¤ë‹ˆë‹¤.

<br />
<br />
<br />

![kakao8](./kakao8.png)

ìƒì„±ëœ **Client Secret**ì„ ì–´ë”˜ê°€ì— ì˜ ì ì–´ ë‘ì‹œê³ , **í™œì„±í™” ìƒíƒœ**ë¥¼ ì‚¬ìš©ì•ˆí•¨ì—ì„œ **ì‚¬ìš©í•¨**ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.

ì €ëŠ” ì´ì œë¶€í„° ì´ë¥¼ **mallang-kakao-secret-key** ë¡œ ë¶€ë¥´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

![kakao9](./kakao9.png)

**ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸** - **ë™ì˜í•­ëª©**ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.

ì´ê³³ì—ì„œëŠ” ì‚¬ìš©í•  ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì„¤ì •í•´ì£¼ë©´ ë˜ëŠ”ë°ìš”, ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” **ë‹‰ë„¤ì„**(profile_nickname)ê³¼ **í”„ë¡œí•„ ì‚¬ì§„**(profile_image)ë§Œì„ ì„¤ì •í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

![kakao10](./kakao10.png)

ìœ„ì™€ ê°™ì´ **í•„ìˆ˜ ë™ì˜**ë¥¼ í´ë¦­í•œ ë’¤ ì €ì¥í•´ì£¼ì„¸ìš”.

ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ê¸°ë³¸ì ì¸ ì„¤ì •ì´ ëë‚¬ê³ , ì—¬ê¸°ì„œ ìƒì„±í•œ ì •ë³´ë“¤ì„ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> REST API í‚¤(client_id) : mallang-kakao-client-id<br/>
> Client Secret : mallang-kakao-secret-key<br/>
> Redirect URI : http://localhost:3000/oauth/redirected/kakao<br/>
> ë™ì˜ í•­ëª© : ë‹‰ë„¤ì„(profile_nickname), í”„ë¡œí•„ ì‚¬ì§„(profile_image)

ì´ì œ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />
<br />
<br />

## ğŸ§ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ ì‘ì„± (React)

íŒŒì¼ì€ index.js, App.js, KakaoRedirectPage.js, LoginPage.js 4ê°œì…ë‹ˆë‹¤.

í”„ë¡ íŠ¸ì—”ë“œ íŒ¨í‚¤ì§€ë¥¼ ì–´ë–»ê²Œ ë‚˜ëˆ ì•¼ í•  ì§€ ëª°ë¼ì„œ ê·¸ëƒ¥ í•˜ë‚˜ì— ë•Œë ¤ë°•ì•˜ìŠµë‹ˆë‹¤.

![code1](./code1.png)

<br />
<br />
<br />

### index.js

```js
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
```

ì´ê±´ ë©”ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤.

<br />
<br />
<br />

### App.js

```js
import { BrowserRouter, Routes, Route } from "react-router-dom";
import LoginPage from "./LoginPage";
import KakaoRedirectPage from "./KakaoRedirectPage";

const App = () => {
  return (
    <div className="App">
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<LoginPage />}></Route>
          <Route
            path="/oauth/redirected/kakao"
            element={<KakaoRedirectPage />}
          ></Route>
        </Routes>
      </BrowserRouter>
    </div>
  );
};

export default App;
```

ë¼ìš°í„°ë¥¼ í†µí•´ì„œ /ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ê³ ,

**/oauth/redirected/kakao**ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ KakaoRedirectPageë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

ì´ë•Œ **/oauth/redirected/kakao** ëŠ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ APIì— **Redirect URI**ë¡œ ì„¤ì •í•œ URIì…ë‹ˆë‹¤.

(ì €ëŠ” Redirect URIë¥¼ http://localhost:3000**/oauth/**redirected**/kakao**ë¡œ ì„¤ì •í–ˆì—ˆìŠµë‹ˆë‹¤.)

<br />
<br />
<br />

### LoginPage.js

```js
import React from "react";

const LoginPage = () => {
  const handleButtonClick = () => {
    window.location.href = "http://localhost:8080/oauth/kakao";
  };

  return (
    <div
      style={{
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        height: "100vh",
      }}
    >
      <button
        onClick={handleButtonClick}
        style={{
          padding: "10px 20px",
          fontSize: "18px",
          borderRadius: "5px",
          cursor: "pointer",
        }}
      >
        ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸
      </button>
    </div>
  );
};

export default LoginPage;
```

ê·¸ëƒ¥ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ ë²„íŠ¼ í•˜ë‚˜ ìˆëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.

ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ http://localhost:8080**/oauth/kakao**ë¡œ ì´ë™í•˜ê²Œ ë˜ëŠ”ë°ìš”, ì´ëŠ” ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬í•˜ë©° cliend_id, redirect_uri ë“±ì„ í¬í•¨í•˜ì—¬ **ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ Redirect** ì‹œì¼œì¤ë‹ˆë‹¤.

<br />
<br />
<br />

### KakaoRedirectPage.js

```js
import React, { useEffect } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import axios from "axios";

const KakaoRedirectPage = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const handleOAuthKakao = async (code) => {
    try {
      // ì¹´ì¹´ì˜¤ë¡œë¶€í„° ë°›ì•„ì˜¨ codeë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ì—¬ ì¹´ì¹´ì˜¤ë¡œ íšŒì›ê°€ì… & ë¡œê·¸ì¸í•œë‹¤
      const response = await axios.get(
        `http://localhost:8080/oauth/login/kakao?code=${code}`
      );
      const data = response.data; // ì‘ë‹µ ë°ì´í„°
      alert("ë¡œê·¸ì¸ ì„±ê³µ: " + data);
      navigate("/success");
    } catch (error) {
      navigate("/fail");
    }
  };

  useEffect(() => {
    const searchParams = new URLSearchParams(location.search);
    const code = searchParams.get("code"); // ì¹´ì¹´ì˜¤ëŠ” Redirect ì‹œí‚¤ë©´ì„œ codeë¥¼ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì¤€ë‹¤.
    if (code) {
      alert("CODE = " + code);
      handleOAuthKakao(code);
    }
  }, [location]);

  return (
    <div>
      <div>Processing...</div>
    </div>
  );
};

export default KakaoRedirectPage;
```

í•´ë‹¹ í˜ì´ì§€ëŠ” App.jsì— ì˜í•´ **/oauth/redirected/kakao**ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ë³´ì—¬ì§ˆ í™”ë©´ì…ë‹ˆë‹¤.

í•´ë‹¹ í™”ë©´ì€ ë³´ì—¬ì§€ìë§ˆì http://localhost:8080/oauth/login/kakaoë¡œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.

ì´ëŠ” ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ì— ì˜í•´ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ëŠ” í˜ì´ì§€ë¡œ, ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” ë™ì‹œì— ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ **code**ê°€ í•¨ê»˜ ì „ë‹¬ë˜ëŠ”ë°ìš”, ì´ë¥¼ ì¶”ì¶œí•˜ì—¬ ë°±ì—”ë“œ ì„œë²„ì— í•¨ê»˜ ì „ë‹¬í•©ë‹ˆë‹¤.

ì›ë˜ëŠ” AccessTokenë“±ì„ ë°±ì—”ë“œ ì„œë²„ë¡œë¶€í„° ë°›ê² ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì½”ë“œê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ê¸°ë•Œë¬¸ì— ë‹¨ìˆœ Idë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒìœ¼ë¡œ íƒ€í˜‘í•˜ê² ìŠµë‹ˆë‹¤.

êµ¬ì²´ì ì¸ ë™ì‘ ê³¼ì •ì€ ë°±ì—”ë“œ ì½”ë“œê¹Œì§€ ì‘ì„±í•œ ë’¤ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />
<br />

## ğŸ§ ë°±ì—”ë“œ ì½”ë“œ ì‘ì„± (Spring)

ì´ˆê¸° ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![code2](./code2.png)

<br />
<br />
<br />

### ğŸ³ build.gradle

```groovy
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.1.2'
    id 'io.spring.dependency-management' version '1.1.2'
}

group = 'mallang'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'

    // Http Interface
    implementation 'org.springframework.boot:spring-boot-starter-webflux'

    compileOnly 'org.projectlombok:lombok'

    runtimeOnly 'com.h2database:h2'

    // FOR @ConfigurationProperties
    annotationProcessor "org.springframework.boot:spring-boot-configuration-processor"

    annotationProcessor 'org.projectlombok:lombok'

    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'io.rest-assured:rest-assured:5.3.0'
}

tasks.named('test') {
    useJUnitPlatform()
}

// FOR @ConfigurationProperties
tasks.named('compileJava') {
    inputs.files(tasks.named('processResources'))
}
```

ë³„ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ë„˜ì–´ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ application.yml

```yml
logging:
  level:
    org.hibernate.orm.jdbc.bind: TRACE

spring:
  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        highlight_sql: true

    hibernate:
      ddl-auto: create
```

ì´ê²ƒë„ ë³„ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ë„˜ì–´ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ëŒ€ì²´ë¡œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê¸° ìœ„í•œ ì„¤ì •ì…ë‹ˆë‹¤.

ì´ˆê¸° ì„¤ì •ì€ ëë‚¬ê³ , ì´ì œë¶€í„° ì½”ë“œë¥¼ ì‘ì„±í•  ê²ƒì¸ë°ìš”, ì²˜ìŒì—ëŠ” ê°„ë‹¨íˆ êµ¬í˜„í•œ ë’¤ ë¦¬íŒ©í† ë§ í•˜ëŠ” ê³¼ì •ì„ ë³´ì—¬ë“œë¦´ê¹Œ ì‹¶ì—ˆì§€ë§Œ ë„ˆë¬´ ë£¨ì¦ˆí•´ì§ˆ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ì„œ, ì¡°ê¸ˆ ë³µì¡í•˜ë”ë¼ë„ ìµœì¢… í˜•íƒœì˜ ì½”ë“œë¥¼ ë³´ì—¬ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ êµ¬í˜„ ìˆœì„œ

êµ¬í˜„ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> 1\. ì‚¬ìš©ìê°€ í”„ë¡ íŠ¸ì—”ë“œë¥¼ í†µí•´ http://localhost:8080**/oauth/kakao**ë¡œ ì ‘ì†í•˜ë©´ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ Redirect ì‹œí‚¤ëŠ” ê³¼ì •ì„ êµ¬í˜„í•œë‹¤.
>
> ì‚¬ìš©ìê°€ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ & ì •ë³´ ì œê³µ ë™ì˜ë¥¼ ì§„í–‰í•œ ì´í›„ ì¹´ì¹´ì˜¤í†¡ ì¸ì¦ ì„œë²„ì—ì„œ í”„ë¡ íŠ¸ì—”ë“œë¡œ Auth Codeë¥¼ í¬í•¨í•˜ì—¬ Redirect ì‹œí‚¨ë‹¤.
>
> í”„ë¡ íŠ¸ì—”ë“œëŠ” Redirect ë˜ëŠ” ìˆœê°„ Auth Codeë¥¼ êº¼ë‚´ì„œ http://localhost:8080**/oauth/login/kakao**?**code={ë°›ì€ Auth Code}**ë¡œ POST ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
>
> 2\. /oauth/login/**kakao**ë¡œ auth codeì™€ í•¨ê»˜ POST ìš”ì²­ì´ ë„ì°©í•˜ë©´ ë°±ì—”ë“œëŠ” ë°›ì€Â **auth code**ì™€ í•¨ê»˜ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ì— **AccessToken**ì„ ìš”ì²­í•˜ì—¬ ë°œê¸‰ë°›ëŠ”ë‹¤.
>
> 3\. ë°›ì•„ì˜¨ AccessTokenì„ ê°€ì§€ê³  ì¹´ì¹´ì˜¤ì— ë“±ë¡ëœ íšŒì› ì •ë³´(ë‹‰ë„¤ì„, í”„ë¡œí•„ ì‚¬ì§„)ë¥¼ ì¡°íšŒí•œë‹¤.
>
> 4\. ë°›ì•„ì˜¨ ì •ë³´ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ì§„í–‰í•œë‹¤. ì´ë•Œ íšŒì›ê°€ì… ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ íšŒì›ê°€ì…ë„ í•¨ê»˜ ì§„í–‰í•œë‹¤.
>
> 5\. /oauth/login/kakaoë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ 2~4ì˜ ê³¼ì •ì„ í†µí•´ ë¡œê·¸ì¸ì„ ì§„í–‰í•œ ë’¤, AccessToken(ì–˜ëŠ” ë°±ì—”ë“œê°€ ì¸ì¦ì„ ìœ„í•´ ë°œê¸‰í•´ì£¼ëŠ”ì• )ì„ ìƒì„±í•˜ê³ , ì´ë¥¼ ë©”ì„¸ì§€ ë³¸ë¬¸ì— ë‹´ëŠ”ë‹¤.

ìœ„ ê³¼ì •ì„ ì§„í–‰í•˜ë©° í™•ì¥ì— ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , ì´í›„ Naverë„ ì¶”ê°€í•´ë³´ë©° ì–¼ë§ˆë‚˜ ê°„ë‹¨í•˜ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ ìµœì¢… êµ¬ì¡° ë¯¸ë¦¬ ì‚´í´ë³´ê¸°

![code3](./code3.png)

<br />
<br />
<br />
<br />

## ğŸ§ 1. /oauth/kakaoìœ¼ë¡œ ì ‘ì†í•˜ë©´ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ Redirect ì‹œí‚¨ë‹¤.

### âœ¨ OauthServerType

```java
package mallang.oauth.domain;

import static java.util.Locale.ENGLISH;

public enum OauthServerType {

    KAKAO,
    ;

    public static OauthServerType fromName(String type) {
        return OauthServerType.valueOf(type.toUpperCase(ENGLISH));
    }
}
```

ì´ëŠ” ì¹´ì¹´ì˜¤, êµ¬ê¸€, ë„¤ì´ë²„ ë“± Oauth2.0 ì¸ì¦ì„ ì œê³µí•˜ëŠ” ì„œë²„ì˜ ì¢…ë¥˜ë¥¼ ëª…ì‹œí•  Enumì…ë‹ˆë‹¤.

"**kakao**"ë¥¼ í†µí•´ OauthServerType.**KAKAO**ë¥¼ ì°¾ì•„ì˜¤ê¸° ìœ„í•´ fromName() ì´ë¼ëŠ” ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ì œ OauthServerTypeë³„ë¡œ í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ Auth Codeë¥¼ ë°›ì•„ì˜¤ëŠ” URLì„ ìƒì„±í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì‘ì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ AuthCodeRequestUrlProvider

```java
package mallang.oauth.domain.authcode;

import mallang.oauth.domain.OauthServerType;

public interface AuthCodeRequestUrlProvider {

    OauthServerType supportServer();

    String provide();
}
```

ì´ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ, AuthCodeë¥¼ ë°œê¸‰í•  URLì„ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

supportServer()ëŠ” ìì‹ ì´ ì–´ë–¤ OauthServerTypeë¥¼ ì§€ì›í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ KakaoAuthCodeRequestUrlProviderëŠ” OauthServerTypeìœ¼ë¡œ KAKAOë¥¼ ë°˜í™˜í•  ê²ƒì…ë‹ˆë‹¤.

provide()ë¥¼ í†µí•´ URLì„ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ë©°, í•´ë‹¹ ì£¼ì†Œë¡œ Redirect í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜µë‹ˆë‹¤.

![kakao sample](./kakao_sample1.png)

ê·¸ë¦¬ê³  ì§€ê¸ˆì€ Kakao ë¿ì´ì§€ë§Œ, ì´í›„ Naver ë“± ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë„ ì¶”ê°€í•  ê²ƒì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ê¸°ëŠ¥ì„ ì¸í„°í˜ì´ìŠ¤ë¡œ ì¶”ìƒí™”í•˜ì˜€ìŠµë‹ˆë‹¤.

Kakaoì—ì„œ Auth Codeë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•œ APIëŠ” ë‹¤ìŒ ë§í¬([https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-code](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-code))ì— ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

<br />

![kakao api1](./kakao_api1.png)
![kakao api2](./kakao_api2.png)

ì•„ë˜ì˜ ì €í¬ê°€ ì„¤ì •í•œ ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ,

> REST API í‚¤(client_id) : mallang-kakao-client-id<br/>
> Client Secret : mallang-kakao-secret-key<br/>
> Redirect URI : http://localhost:3000/oauth/redirected/kakao<br/>
> ë™ì˜ í•­ëª© : ë‹‰ë„¤ì„(profile_nickname), í”„ë¡œí•„ ì‚¬ì§„(profile_image)

<br />

í•„ìˆ˜ê°’ë§Œ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, ë‹¤ìŒê³¼ ê°™ì€ URLë¡œ ìš”ì²­ì„ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.

> https://kauth.kakao.com/oauth/authorize<br/>
> ?response_type=code<br/>
> &client_id=mallang-kakao-client-id<br/>
> &redirect_uri=http://localhost:3000/oauth/redirected/kakao<br/>
> &scope=profile_nickname,profile_image

<br />

ì´ì— ë§ê²Œ êµ¬í˜„í•œ êµ¬í˜„ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ KakaoAuthCodeRequestUrlProvider

```java
package mallang.oauth.infra.oauth.kakao.authcode;

import lombok.RequiredArgsConstructor;
import mallang.oauth.domain.OauthServerType;
import mallang.oauth.domain.authcode.AuthCodeRequestUrlProvider;
import mallang.oauth.infra.oauth.kakao.KakaoOauthConfig;
import org.springframework.stereotype.Component;
import org.springframework.web.util.UriComponentsBuilder;

@Component
@RequiredArgsConstructor
public class KakaoAuthCodeRequestUrlProvider implements AuthCodeRequestUrlProvider {

    private final KakaoOauthConfig kakaoOauthConfig;

    @Override
    public OauthServerType supportServer() {
        return OauthServerType.KAKAO;
    }

    @Override
    public String provide() {
        return UriComponentsBuilder
                .fromUriString("https://kauth.kakao.com/oauth/authorize")
                .queryParam("response_type", "code")
                .queryParam("client_id", kakaoOauthConfig.clientId())
                .queryParam("redirect_uri", kakaoOauthConfig.redirectUri())
                .queryParam("scope", String.join(",", kakaoOauthConfig.scope()))
                .toUriString();
    }
}
```

<br />

ì´ë•Œ KakaoOauthConfigëŠ” ì €ì˜ê°€ ì„¤ì •í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” í´ë˜ìŠ¤ë¡œ, ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<br />
<br />

### âœ¨ KakaoOauthConfig

```java
package mallang.oauth.infra.oauth.kakao;

import org.springframework.boot.context.properties.ConfigurationProperties;

@ConfigurationProperties(prefix = "oauth.kakao")
public record KakaoOauthConfig(
        String redirectUri,
        String clientId,
        String clientSecret,
        String[] scope
) {
}
```

**application.yml**ì— **oauth.kakao**ë¡œ ì„¤ì •ëœ ì •ë³´ë“¤ì„ í†µí•´ ìƒì„±ë©ë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ application.yml ìˆ˜ì •

ì´ì œ application.yml íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤.

```yml
logging:
  level:
    org.hibernate.orm.jdbc.bind: TRACE

spring:
  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        highlight_sql: true

    hibernate:
      ddl-auto: create

# ì¶”ê°€
oauth:
  kakao:
    client_id: mallang-kakao-client-id # REST API í‚¤
    redirect_uri: http://localhost:3000/oauth/redirected/kakao
    client_secret: mallang-kakao-secret-key # Client Secret í‚¤
    scope: profile_nickname, profile_image
```

ê·¸ë¦¬ê³  @ConfigurationPropertiesë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” @ConfigurationPropertiesScanì´ í•„ìš”í•©ë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthApplication ìˆ˜ì •

```java
package mallang.oauth;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.context.properties.ConfigurationPropertiesScan;

@SpringBootApplication
@ConfigurationPropertiesScan
public class OauthApplication {

    public static void main(String[] args) {
        SpringApplication.run(OauthApplication.class, args);
    }

}
```

ì´ì œ ì´ë¥¼ ì‚¬ìš©í•´ì•¼ê² ì£ ?

<br />
<br />
<br />

### âœ¨ AuthCodeRequestUrlProviderComposite

```java
package mallang.oauth.domain.authcode;

import static java.util.function.Function.identity;
import static java.util.stream.Collectors.toMap;

import java.util.Map;
import java.util.Optional;
import java.util.Set;
import mallang.oauth.domain.OauthServerType;
import org.springframework.stereotype.Component;

@Component
public class AuthCodeRequestUrlProviderComposite {

    private final Map<OauthServerType, AuthCodeRequestUrlProvider> mapping;

    public AuthCodeRequestUrlProviderComposite(Set<AuthCodeRequestUrlProvider> providers) {
        mapping = providers.stream()
                .collect(toMap(
                        AuthCodeRequestUrlProvider::supportServer,
                        identity()
                ));
    }

    public String provide(OauthServerType oauthServerType) {
        return getProvider(oauthServerType).provide();
    }

    public AuthCodeRequestUrlProvider getProvider(OauthServerType oauthServerType) {
        return Optional.ofNullable(mapping.get(oauthServerType))
                .orElseThrow(() -> new RuntimeException("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì†Œì…œ ë¡œê·¸ì¸ íƒ€ì…ì…ë‹ˆë‹¤."));
    }
}
```

Composite íŒ¨í„´ì„ ì¡°ê¸ˆ ë³€í˜•í•˜ì—¬ OauthServerTypeì˜ ì¢…ë¥˜ì— ë”°ë¼, ì´ì— í•´ë‹¹í•˜ëŠ” AuthCodeRequestUrlProvierë¥¼ ì‚¬ìš©í•˜ì—¬ URLì„ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ ìœ„ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ supportServer()ë¼ëŠ” ë©”ì„œë“œë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ Naver ë¡œê·¸ì¸ ë“±ì„ ì¶”ê°€í•  ë•Œ, ê¸°ì¡´ ì½”ë“œì˜ ë³€ê²½ ì—†ì´ ìƒˆë¡œ ì¶”ê°€ëœ íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ì´ì œ ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ URLì„ ì‹¤ì œë¡œ ë§Œë“¤ì–´ë‚´ëŠ” Service ì½”ë“œë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthService

```java
package mallang.oauth.application;

import lombok.RequiredArgsConstructor;
import mallang.oauth.domain.OauthServerType;
import mallang.oauth.domain.authcode.AuthCodeRequestUrlProviderComposite;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class OauthService {

    private final AuthCodeRequestUrlProviderComposite authCodeRequestUrlProviderComposite;

    public String getAuthCodeRequestUrl(OauthServerType oauthServerType) {
        return authCodeRequestUrlProviderComposite.provide(oauthServerType);
    }
}
```

OauthServerTypeì„ ë°›ì•„ì„œ í•´ë‹¹ ì¸ì¦ ì„œë²„ì—ì„œ Auth Codeë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•œ URL ì£¼ì†Œë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.

ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” Controller ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthController

```java
package mallang.oauth.presentation;

import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.SneakyThrows;
import mallang.oauth.application.OauthService;
import mallang.oauth.domain.OauthServerType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RequiredArgsConstructor
@RequestMapping("/oauth")
@RestController
public class OauthController {

    private final OauthService oauthService;

    @SneakyThrows
    @GetMapping("/{oauthServerType}")
    ResponseEntity<Void> redirectAuthCodeRequestUrl(
            @PathVariable OauthServerType oauthServerType,
            HttpServletResponse response
    ) {
        String redirectUrl = oauthService.getAuthCodeRequestUrl(oauthServerType);
        response.sendRedirect(redirectUrl);
        return ResponseEntity.ok().build();
    }
}
```

@PathVariableì„ í†µí•´ /oauth/**kakao** ë“±ì˜ ìš”ì²­ì—ì„œ **kakao**ë¥¼ OauthServerTypeë¡œ ë³€í™˜í•˜ì—¬ ë°›ì•„ì˜µë‹ˆë‹¤.

ì´ëŠ” Converterë¥¼ ë“±ë¡í•´ ì£¼ì–´ì•¼ í•˜ëŠ”ë°, ì¡°ê¸ˆ ë’¤ì— ì‚´í´ë³´ê³  ì¼ë‹¨ ë¡œì§ì˜ íë¦„ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

ì‚¬ìš©ìê°€ í”„ë¡ íŠ¸ì—”ë“œë¥¼ í†µí•´ /oauth/kakaoë¡œ ì ‘ì†í•˜ë©´ ìœ„ì˜ ë©”ì„œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

ì´ë•Œ kakaoëŠ” OauthServerType.KAKAOë¡œ ë³€í™˜ë  ê²ƒì…ë‹ˆë‹¤.

ì´ì œ ìœ„ì—ì„œ êµ¬í˜„í•œ Serviceë¥¼ í†µí•´ KAKAOì—ì„œ Auth Codeë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•œ URLì„ ìƒì„±í•˜ê³ ,

ì—¬ê¸°ì„œ ìƒì„±ëœ URLë¡œ ì‚¬ìš©ìë¥¼ Redirect ì‹œí‚µë‹ˆë‹¤.

ì•„ë˜ Converter êµ¬í˜„ì„ ì ê¹ ì‚´í´ë³´ê³ , ì—¬ê¸°ê¹Œì§€ì˜ ë™ì‘ì„ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthServerTypeConverter

```java
package mallang.oauth.presentation;

import mallang.oauth.domain.OauthServerType;
import org.springframework.core.convert.converter.Converter;

public class OauthServerTypeConverter implements Converter<String, OauthServerType> {

    @Override
    public OauthServerType convert(String source) {
        return OauthServerType.fromName(source);
    }
}
```

Stringì„ OauthServerTypeìœ¼ë¡œ ë³€í™˜í•´ì¤ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì´ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ WebConfigurerë¥¼ êµ¬í˜„í•˜ì—¬ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ WebConfig

```java
package mallang.oauth.common.config;

import lombok.RequiredArgsConstructor;
import mallang.oauth.presentation.OauthServerTypeConverter;
import org.springframework.context.annotation.Configuration;
import org.springframework.format.FormatterRegistry;
import org.springframework.http.HttpMethod;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
@RequiredArgsConstructor
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("http://localhost:3000")
                .allowedMethods(
                        HttpMethod.GET.name(),
                        HttpMethod.POST.name(),
                        HttpMethod.PUT.name(),
                        HttpMethod.DELETE.name(),
                        HttpMethod.PATCH.name()
                )
                .allowCredentials(true)
                .exposedHeaders("*");
    }

    @Override
    public void addFormatters(FormatterRegistry registry) {
        registry.addConverter(new OauthServerTypeConverter());
    }
}
```

CORS ì„¤ì •ê¹Œì§€ ë¯¸ë¦¬ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ˜ ì¤‘ê°„ ì ê²€ - ë™ì‘ í™•ì¸í•˜ê¸°

reactì™€ springì„ ëª¨ë‘ ì‹¤í–‰í•©ë‹ˆë‹¤.

> reactë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” npm install, npm install react-router-dom axios í•œ ë²ˆ ì‹¤í–‰ ì´í›„ npm startë¥¼ í†µí•´ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

http://localhost:3000ìœ¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.

![kakao_sample2](./kakao_sample2.png)

ì‚¬ìš©ìëŠ” ìœ„ì™€ ê°™ì´ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ë³´ê³ , í´ë¦­í•  ê²ƒì…ë‹ˆë‹¤.

(ì´ë¥¼ í´ë¦­í•˜ë©´, ë°±ì—”ë“œì—ì„œ Kakao ì¸ì¦ ì„œë²„ì—ì„œ Auth codeë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì¼œì¤ë‹ˆë‹¤.)

<br />
<br />

![kakao_sample3](./kakao_sample3.png)

í´ë¦­í•˜ë©´ ìœ„ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜µë‹ˆë‹¤.

ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ì§„í–‰í•©ë‹ˆë‹¤.

<br />
<br />

![kakao_sample4](./kakao_sample4.png)

ì´ë•Œ í˜„ì¬ ì‚¬ì´íŠ¸ì˜ URLì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> https://kauth.kakao.com/oauth/authorize?scope=profile\_nickname%2Cprofile\_image&response\_type=code&redirect\_uri=http%3A%2F%2Flocalhost%3A3000%2Foauth%2Fredirected%2Fkakao&through\_account=true&client\_id=ë¹„ë°€&additional\_auth\_login=true

ì´ë¥¼ [URL Decode](https://www.urldecoder.org/)ë¥¼ í†µí•´ ë””ì½”ë”©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> https://kauth.kakao.com/oauth/authorize
> ?scope=profile_nickname,profile_image
> &response_type=code
> &redirect_uri=http://localhost:3000/oauth/redirected/kakao
> &through_account=true <-- ì˜ˆëŠ” ë¡œê·¸ì¸ í•˜ê³  ë“¤ì–´ì˜¤ë©´ ìë™ ì¶”ê°€ë©ë‹ˆë‹¤. ë¬´ì‹œí•˜ì„¸ìš”
> &client_id=REST API ID
> &additional_auth_login=true <-- ì˜ˆëŠ” ë¡œê·¸ì¸ í•˜ê³  ë“¤ì–´ì˜¤ë©´ ìë™ ì¶”ê°€ë©ë‹ˆë‹¤. ë¬´ì‹œí•˜ì„¸ìš”

ë°±ì—”ë“œì—ì„œ ì„¤ì •í•´ì¤€ URLì´ ì˜ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë™ì˜í•˜ê³  ê³„ì†í•˜ê¸°**ë¥¼ í´ë¦­í•´ë³´ê² ìŠµë‹ˆë‹¤.

<br />
<br />

![kakao_sample5](./kakao_sample5.png)

Auth Codeê¹Œì§€ ì˜ ë°›ì•„ì˜¨ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ê·¸ ë‹¤ìŒ ë‹¨ê³„ì¸ Auth Codeë¥¼ í†µí•´ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ë¡œë¶€í„° AccessTokenì„ ë°›ì•„ì˜¤ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />
<br />

## ğŸ§ 2. Auth Codeë¥¼ í†µí•´ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ë¡œë¶€í„° AccessTokenì„ ë°›ì•„ì˜¨ë‹¤

ìš°ì„  ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ê°€ ì œê³µí•˜ëŠ” AccessTokenì„ ë°›ì•„ì˜¤ê¸° ìœ„í•œ APIëŠ” ë‹¤ìŒ ë§í¬([https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-token](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-token))ì— ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

<br />

![kakao_api3](./kakao_api3.png)

![kakao_api4](./kakao_api4.png)

![kakao_api5](./kakao_api5.png)

ì´ì— ë§ê²Œ ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ì•„ì˜¤ëŠ” ê³¼ì •ì„ êµ¬í˜„í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì™¸ë¶€ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì—ëŠ” ê°€ì¥ í”í•œ ë°©ë²•ìœ¼ë¡œëŠ” RestTemplateì´ë‚˜ WebClientë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ê°„ì†Œí™”ë¥¼ ìœ„í•´ì„œëŠ” FeignClient ë“±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì €ëŠ” ì´ë²ˆì—ëŠ” ìŠ¤í”„ë§ 6ì— ìƒˆë¡œ ì¶”ê°€ëœ [HTTP Interface Client](https://docs.spring.io/spring-framework/reference/web/webflux-http-interface-client.html)ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ìš°ì„  ìœ„ ìš”ì²­ì˜ ì‘ë‹µì„ ê°ì²´ë¡œ ë°›ì•„ì˜¤ê¸° ìœ„í•´ DTOë¥¼ ìƒì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ KakaoToken

```java
package mallang.oauth.infra.oauth.kakao.dto;

import com.fasterxml.jackson.databind.PropertyNamingStrategies.SnakeCaseStrategy;
import com.fasterxml.jackson.databind.annotation.JsonNaming;

@JsonNaming(SnakeCaseStrategy.class)
public record KakaoToken(
        String tokenType,
        String accessToken,
        String idToken,
        Integer expiresIn,
        String refreshToken,
        Integer refreshTokenExpiresIn,
        String scope
) {
}
```

@JsonNaming(SnakeCaseStrategy.class)ë¥¼ í†µí•´ token_typeê³¼ ê°™ì€ ì‘ë‹µì„ tokenTypeìœ¼ë¡œ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ KakaoApiClient

```java
package mallang.oauth.infra.oauth.kakao.client;

import static org.springframework.http.MediaType.APPLICATION_FORM_URLENCODED_VALUE;

import mallang.oauth.infra.oauth.kakao.dto.KakaoToken;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.service.annotation.PostExchange;

public interface KakaoApiClient {

    @PostExchange(url = "https://kauth.kakao.com/oauth/token", contentType = APPLICATION_FORM_URLENCODED_VALUE)
    KakaoToken fetchToken(@RequestParam MultiValueMap<String, String> params);
}
```

ìœ„ëŠ” Http Interface Clientë¥¼ ì‚¬ìš©í•œ ì½”ë“œì…ë‹ˆë‹¤.

ìš°ì„  Urlì—ëŠ” AccessTokenì„ ë°›ì•„ì˜¤ê¸° ìœ„í•œ URLì„ ëª…ì‹œí•˜ì˜€ê³ , ì´ë¥¼ ìœ„í•œ ContentTypeê³¼ ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•„ì•¼ í•˜ë¯€ë¡œ MultiValueMapì„ íŒŒë¼ë¯¸í„°ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

ì‘ë‹µ ê°’ì€ KakaoTokenì„ í†µí•´ ê°ì²´ë¡œ ë°”ë¡œ ë°›ì•„ì˜¬ ìˆ˜ ìˆë„ë¡ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

ìœ„ì²˜ëŸ¼ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, í•œê°€ì§€ ì¶”ê°€ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ HttpInterfaceConfig

```java
package mallang.oauth.infra.oauth.config;

import mallang.oauth.infra.oauth.kakao.client.KakaoApiClient;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.reactive.function.client.WebClient;
import org.springframework.web.reactive.function.client.support.WebClientAdapter;
import org.springframework.web.service.invoker.HttpServiceProxyFactory;

@Configuration
public class HttpInterfaceConfig {

    @Bean
    public KakaoApiClient kakaoApiClient() {
        return createHttpInterface(KakaoApiClient.class);
    }

    private <T> T createHttpInterface(Class<T> clazz) {
        WebClient webClient = WebClient.create();
        HttpServiceProxyFactory build = HttpServiceProxyFactory
                .builder(WebClientAdapter.forClient(webClient)).build();
        return build.createClient(clazz);
    }
}
```

ìœ„ì™€ ê°™ì´ Http Interface Client êµ¬í˜„ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì•„ì§ êµ¬í˜„í•˜ì§€ ì•Šì€ í´ë˜ìŠ¤ë“¤ì´ ë§ê¸°ì— ì—¬ê¸°ì„œ ë°”ë¡œ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ê² ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ê²ƒì„ì„ ì°¸ê³ ë¥¼ ìœ„í•´ ë‚¨ê²¨ë‘ê² ìŠµë‹ˆë‹¤.\

<br />
<br />
<br />

```java
@Component
@RequiredArgsConstructor
public class KakaoMemberClient implements OauthMemberClient {

    private final KakaoApiClient kakaoApiClient;
    private final KakaoOauthConfig kakaoOauthConfig;


    @Override
    public OauthMember fetch(String authCode) {
        KakaoToken tokenInfo = kakaoApiClient.fetchToken(tokenRequestParams(authCode));
        // ìƒëµ
    }

    private MultiValueMap<String, String> tokenRequestParams(String authCode) {
        MultiValueMap<String, String> params = new LinkedMultiValueMap<>();
        params.add("grant_type", "authorization_code");
        params.add("client_id", kakaoOauthConfig.clientId());
        params.add("redirect_uri", kakaoOauthConfig.redirectUri());
        params.add("code", authCode);
        params.add("client_secret", kakaoOauthConfig.clientSecret());
        return params;
    }
}
```

<br />
<br />
<br />
<br />

## ğŸ§ 3. AccessTokenì„ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ì•„ì˜¨ë‹¤

ì´ì œ ìœ„ì—ì„œ ë°œê¸‰ë°›ì€ AccessTokenì„ í†µí•´ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ì•¼ í•©ë‹ˆë‹¤.

ì´ì— ëŒ€í•œ APIëŠ” ë‹¤ìŒ ë§í¬([https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#req-user-info](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#req-user-info))ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />

![kakao_api6](./kakao_api6.png)
![kakao_api7](./kakao_api7.png)
![kakao_api8](./kakao_api8.png)
![kakao_api9](./kakao_api9.png)

ìœ„ í˜•ì‹ì— ë§ê²Œ AccessTokenì„ ë°œê¸‰í•  ë•Œ ì²˜ëŸ¼ HTTP Interface Clientë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ìš°ì„  ì‘ë‹µì„ ë§¤í•‘í•  í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ KakaoMemberResponse

```java
package mallang.oauth.infra.oauth.kakao.dto;

import static mallang.oauth.domain.OauthServerType.KAKAO;

import com.fasterxml.jackson.databind.PropertyNamingStrategies.SnakeCaseStrategy;
import com.fasterxml.jackson.databind.annotation.JsonNaming;
import java.time.LocalDateTime;
import mallang.oauth.domain.OauthId;
import mallang.oauth.domain.OauthMember;

@JsonNaming(SnakeCaseStrategy.class)
public record KakaoMemberResponse(
        Long id,
        boolean hasSignedUp,
        LocalDateTime connectedAt,
        KakaoAccount kakaoAccount
) {

    public OauthMember toDomain() {
        return OauthMember.builder()
                .oauthId(new OauthId(String.valueOf(id), KAKAO))
                .nickname(kakaoAccount.profile.nickname)
                .profileImageUrl(kakaoAccount.profile.profileImageUrl)
                .build();
    }

    @JsonNaming(SnakeCaseStrategy.class)
    public record KakaoAccount(
            boolean profileNeedsAgreement,
            boolean profileNicknameNeedsAgreement,
            boolean profileImageNeedsAgreement,
            Profile profile,
            boolean nameNeedsAgreement,
            String name,
            boolean emailNeedsAgreement,
            boolean isEmailValid,
            boolean isEmailVerified,
            String email,
            boolean ageRangeNeedsAgreement,
            String ageRange,
            boolean birthyearNeedsAgreement,
            String birthyear,
            boolean birthdayNeedsAgreement,
            String birthday,
            String birthdayType,
            boolean genderNeedsAgreement,
            String gender,
            boolean phoneNumberNeedsAgreement,
            String phoneNumber,
            boolean ciNeedsAgreement,
            String ci,
            LocalDateTime ciAuthenticatedAt
    ) {
    }

    @JsonNaming(SnakeCaseStrategy.class)
    public record Profile(
            String nickname,
            String thumbnailImageUrl,
            String profileImageUrl,
            boolean isDefaultImage
    ) {
    }
}
```

í•„ìš”ì—†ëŠ” í•„ë“œë„ ë§ì§€ë§Œ, ì–¸ì œ ì–´ë–»ê²Œ ë°”ë€”ì§€ ëª¨ë¥´ê¸°ì— ê·¸ëƒ¥ í•œë²ˆì— ë‹¤ ë“±ë¡í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

ì´ë•Œ toDomain() ë©”ì„œë“œë¥¼ í†µí•´ì„œ ë°›ì•„ì˜¨ ì •ë³´ë¥¼ í† ëŒ€ë¡œ OauthMemberë¥¼ ë§Œë“¤ì–´ ì£¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

OauthMemberëŠ” Oauthë¥¼ í†µí•´ ê°€ì…í•œ íšŒì›ì„ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ì´ë©°, ì´ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthId

```java
package mallang.oauth.domain;

import static jakarta.persistence.EnumType.STRING;
import static lombok.AccessLevel.PROTECTED;

import jakarta.persistence.Column;
import jakarta.persistence.Embeddable;
import jakarta.persistence.Enumerated;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

@Embeddable
@AllArgsConstructor
@NoArgsConstructor(access = PROTECTED)
public class OauthId {

    @Column(nullable = false, name = "oauth_server_id")
    private String oauthServerId;

    @Enumerated(STRING)
    @Column(nullable = false, name = "oauth_server")
    private OauthServerType oauthServerType;

    public String oauthServerId() {
        return oauthServerId;
    }

    public OauthServerType oauthServer() {
        return oauthServerType;
    }
}
```

íŠ¹ì • ì¸ì¦ ì„œë²„ì˜ ì‹ë³„ì ê°’ì„ ì˜ë¯¸í•˜ëŠ” oauthServerIdì™€, ì´ë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ íƒ€ì…ì„ ë¬¶ì–´ OauthIdë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ ë‚´ì—ì„œ ì‹ë³„ìëŠ” ì¤‘ë³µë˜ì§€ ì•Šê² ì§€ë§Œ ì„œë¡œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ê°„ì—ëŠ” ì‹ë³„ìê°€ ì¤‘ë³µë ìˆ˜ë„ ìˆê² ë‹¤ ì‹¶ì—ˆê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ êµ¬í˜„í•˜ì—¬ í˜¹ì‹œ ëª¨ë¥¼ ì‹ë³„ìì˜ ì¤‘ë³µì„ ì˜ˆë°©í•˜ë ¤ í•˜ì˜€ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthMember

```java
package mallang.oauth.domain;

import static lombok.AccessLevel.PROTECTED;

import jakarta.persistence.Embedded;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Table;
import jakarta.persistence.UniqueConstraint;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.NoArgsConstructor;

@Entity
@Builder
@AllArgsConstructor
@NoArgsConstructor(access = PROTECTED)
@Table(name = "oauth_member",
        uniqueConstraints = {
                @UniqueConstraint(
                        name = "oauth_id_unique",
                        columnNames = {
                                "oauth_server_id",
                                "oauth_server"
                        }
                ),
        }
)
public class OauthMember {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Embedded
    private OauthId oauthId;
    private String nickname;
    private String profileImageUrl;

    public Long id() {
        return id;
    }

    public OauthId oauthId() {
        return oauthId;
    }

    public String nickname() {
        return nickname;
    }

    public String profileImageUrl() {
        return profileImageUrl;
    }
}
```

ìë™ ì¦ê°€ë˜ëŠ” id í•˜ë‚˜ì™€, uniqueConstraintsë¥¼ í†µí•´ OauthIdì˜ ìœ ì¼í•¨ì„ ë³´ì¥í•˜ë„ë¡ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

ë˜í•œ ì‚¬ìš©ìì˜ ë³„ëª…ê³¼ í”„ë¡œí•„ ì‚¬ì§„ URLì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µë°›ê¸°ë¡œ í–ˆìœ¼ë¯€ë¡œ, ì´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ í•„ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthMemberRepository

```java
package mallang.oauth.domain;

import java.util.Optional;
import org.springframework.data.jpa.repository.JpaRepository;

public interface OauthMemberRepository extends JpaRepository<OauthMember, Long> {

    Optional<OauthMember> findByOauthId(OauthId oauthId);
}
```

ê°„ë‹¨í•˜ë¯€ë¡œ ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.

ì´ì œ êµ¬í˜„í•´ì•¼ í•  ê²ƒì€ AccessTokenì„ í†µí•´ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ OauthMemberë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤.

ì•„ê¹Œ ìƒì„±í•´ë‘” **KakaoApiClient**ì— ë‹¤ìŒ ë©”ì„œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ KakaoApiClient

```java
package mallang.oauth.infra.oauth.kakao.client;

import static org.springframework.http.HttpHeaders.AUTHORIZATION;
import static org.springframework.http.MediaType.APPLICATION_FORM_URLENCODED_VALUE;

import mallang.oauth.infra.oauth.kakao.dto.KakaoMemberResponse;
import mallang.oauth.infra.oauth.kakao.dto.KakaoToken;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.service.annotation.GetExchange;
import org.springframework.web.service.annotation.PostExchange;

public interface KakaoApiClient {

    @PostExchange(url = "https://kauth.kakao.com/oauth/token", contentType = APPLICATION_FORM_URLENCODED_VALUE)
    KakaoToken fetchToken(@RequestParam MultiValueMap<String, String> params);

    // ì¶”ê°€
    @GetExchange("https://kapi.kakao.com/v2/user/me")
    KakaoMemberResponse fetchMember(@RequestHeader(name = AUTHORIZATION) String bearerToken);
}
```

[ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° API](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#req-user-info)ì— ì•Œë§ê²Œ ë©”ì„œë“œë¥¼ ì‘ì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ **AccessToken**ì„ í†µí•´ **íšŒì› ì •ë³´ë¥¼ ì¡°íšŒ**í•˜ëŠ” ê¸°ëŠ¥ë„ êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ì œ 2ë²ˆê³¼ 3ë²ˆ ê³¼ì •ì„ í•©ì³ì„œ Auth Codeë¥¼ í†µí•´ ìµœì¢…ì ìœ¼ë¡œ OauthMemberë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ ìš°ì„  OauthMemberClientë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthMemberClient

```java
package mallang.oauth.domain.client;

import mallang.oauth.domain.OauthMember;
import mallang.oauth.domain.OauthServerType;

public interface OauthMemberClient {

    OauthServerType supportServer();

    OauthMember fetch(String code);
}
```

ì—¬ê¸°ì„œë„ AuthCodeRequestUrlProviderì™€ ë¹„ìŠ·í•˜ê²Œ supporServer()ë¥¼ ì •ì˜í•´ì£¼ì—ˆê³ ,

fetch() ë©”ì„œë“œë¥¼ í†µí•´ OauthMemberë¥¼ ë°˜í™˜í•´ì£¼ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

fetch() ë©”ì„œë“œëŠ” ì¸ìë¡œ Auth Codeë¥¼ ë°›ìŠµë‹ˆë‹¤.

íšŒì›ê°€ì… í˜¹ì€ ë¡œê·¸ì¸ í•  íšŒì› ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” ê³¼ì •ì„ ë‚˜ì—´í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1.  Auth Codeë¥¼ í†µí•´ AccessToken ë°œê¸‰
2.  AccessTokenì„ í†µí•´ íšŒì› ì •ë³´ ì¡°íšŒ

ì´ ê³¼ì •ì„ Auth Codeë¥¼ í†µí•´ íšŒì› ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ê³¼ì •ìœ¼ë¡œ ìº¡ìŠí™”í•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  AuthCodeRequestUrlProviderCompositeê³¼ ë¹„ìŠ·í•˜ê²Œ, OauthMemberClientCompositeì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthMemberClientComposite

```java
package mallang.oauth.domain.client;

import static java.util.function.Function.identity;
import static java.util.stream.Collectors.toMap;

import java.util.Map;
import java.util.Optional;
import java.util.Set;
import mallang.oauth.domain.OauthMember;
import mallang.oauth.domain.OauthServerType;
import org.springframework.stereotype.Component;

@Component
public class OauthMemberClientComposite {

    private final Map<OauthServerType, OauthMemberClient> mapping;

    public OauthMemberClientComposite(Set<OauthMemberClient> clients) {
        mapping = clients.stream()
                .collect(toMap(
                        OauthMemberClient::supportServer,
                        identity()
                ));
    }

    public OauthMember fetch(OauthServerType oauthServerType, String authCode) {
        return getClient(oauthServerType).fetch(authCode);
    }

    private OauthMemberClient getClient(OauthServerType oauthServerType) {
        return Optional.ofNullable(mapping.get(oauthServerType))
                .orElseThrow(() -> new RuntimeException("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì†Œì…œ ë¡œê·¸ì¸ íƒ€ì…ì…ë‹ˆë‹¤."));
    }
}
```

ì´ ì—­ì‹œë„ ì¹´ì¹´ì˜¤ ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ì„ ê¸°ì¡´ ì½”ë“œì˜ ë³€ê²½ ì—†ì´ ì¶”ê°€í•˜ê¸° ìœ„í•´ ì‘ì„±í•œ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

ì´ì œ OauthMemberClientë¥¼ ì¹´ì¹´ì˜¤ ì„œë¹„ìŠ¤ì— ë§ê²Œ êµ¬í˜„í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ KakaoMemberClient

```java
package mallang.oauth.infra.oauth.kakao;

import lombok.RequiredArgsConstructor;
import mallang.oauth.domain.OauthMember;
import mallang.oauth.domain.OauthServerType;
import mallang.oauth.domain.client.OauthMemberClient;
import mallang.oauth.infra.oauth.kakao.client.KakaoApiClient;
import mallang.oauth.infra.oauth.kakao.dto.KakaoMemberResponse;
import mallang.oauth.infra.oauth.kakao.dto.KakaoToken;
import org.springframework.stereotype.Component;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;

@Component
@RequiredArgsConstructor
public class KakaoMemberClient implements OauthMemberClient {

    private final KakaoApiClient kakaoApiClient;
    private final KakaoOauthConfig kakaoOauthConfig;

    @Override
    public OauthServerType supportServer() {
        return OauthServerType.KAKAO;
    }

    @Override
    public OauthMember fetch(String authCode) {
        KakaoToken tokenInfo = kakaoApiClient.fetchToken(tokenRequestParams(authCode)); // (1)
        KakaoMemberResponse kakaoMemberResponse =
                kakaoApiClient.fetchMember("Bearer " + tokenInfo.accessToken());  // (2)
        return kakaoMemberResponse.toDomain();  // (3)
    }

    private MultiValueMap<String, String> tokenRequestParams(String authCode) {
        MultiValueMap<String, String> params = new LinkedMultiValueMap<>();
        params.add("grant_type", "authorization_code");
        params.add("client_id", kakaoOauthConfig.clientId());
        params.add("redirect_uri", kakaoOauthConfig.redirectUri());
        params.add("code", authCode);
        params.add("client_secret", kakaoOauthConfig.clientSecret());
        return params;
    }
}
```

ì–´ë µì§€ëŠ” ì•Šì„ ê²ƒì´ë¼ ìƒê°ë˜ì§€ë§Œ, fetch() ë©”ì„œë“œì— ëŒ€í•´ ì„¤ëª…ì„ ì§„í–‰í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

(1) - ë¨¼ì € Auth Codeë¥¼ í†µí•´ì„œ AccessTokenì„ ì¡°íšŒí•©ë‹ˆë‹¤.<br/>
(2) - AccessTokenì„ ê°€ì§€ê³  íšŒì› ì •ë³´ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.<br/>
(3) - íšŒì› ì •ë³´ë¥¼ OauthMember ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

ì´ë•Œ (1)ë²ˆ ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ëŠ” **tokenRequestParams**()ëŠ” í•œì°¸ ì „ ì„¤ëª…ì—ì„œ ì ê¹ ì°¸ê³ ìš©ìœ¼ë¡œ ë“±ì¥í–ˆëŠ”ë°ìš”,

[í† í° ë°›ê¸° API](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-token)ì˜ ìš”ì²­ì— ì‚¬ìš©ë˜ëŠ” ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

![kakao api10](./kakao_api10.png)

ì´ì™¸ì—ëŠ” ê·¸ëƒ¥ KakaoApiClientë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì´ë¯€ë¡œ ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.

ì´ì œ í•´ë‹¹ ê³¼ì •ì„ í†µí•´ ìƒì„±í•œ OauthMember ê°ì²´ì— ëŒ€í•´ì„œ ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ë•Œ ë§Œì•½ íšŒì›ê°€ì…ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ íšŒì›ê°€ì…ë„ í•¨ê»˜ ì§„í–‰í•©ë‹ˆë‹¤.

<br />
<br />
<br />

## ğŸ§ 4\. ë°›ì•„ì˜¨ ì •ë³´ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ì§„í–‰í•œë‹¤. ì´ë•Œ íšŒì›ê°€ì… ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ íšŒì›ê°€ì…ë„ í•¨ê»˜ ì§„í–‰í•œë‹¤.

<br />

OauthServiceì— ì´ë¥¼ ìœ„í•œ ë©”ì„œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

<br />

### âœ¨ OauthService

```java
package mallang.oauth.application;

import lombok.RequiredArgsConstructor;
import mallang.oauth.domain.OauthMember;
import mallang.oauth.domain.OauthMemberRepository;
import mallang.oauth.domain.OauthServerType;
import mallang.oauth.domain.authcode.AuthCodeRequestUrlProviderComposite;
import mallang.oauth.domain.client.OauthMemberClientComposite;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class OauthService {

    private final AuthCodeRequestUrlProviderComposite authCodeRequestUrlProviderComposite;
    private final OauthMemberClientComposite oauthMemberClientComposite;
    private final OauthMemberRepository oauthMemberRepository;

    public String getAuthCodeRequestUrl(OauthServerType oauthServerType) {
        return authCodeRequestUrlProviderComposite.provide(oauthServerType);
    }

    // ì¶”ê°€
    public Long login(OauthServerType oauthServerType, String authCode) {
        OauthMember oauthMember = oauthMemberClientComposite.fetch(oauthServerType, authCode);
        OauthMember saved = oauthMemberRepository.findByOauthId(oauthMember.oauthId())
                .orElseGet(() -> oauthMemberRepository.save(oauthMember));
        return saved.id();
    }
}
```

ì½”ë“œëŠ” ë˜ê²Œ ê°„ë‹¨í•©ë‹ˆë‹¤.

ë¨¼ì € ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ë ¤ëŠ” OauthServerTypeì— í•´ë‹¹í•˜ëŠ” íšŒì›ì„ AuthCodeë¥¼ í†µí•´ ì¡°íšŒí•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ìœ ë‹ˆí¬í•¨ì´ ë³´ì¥ë˜ëŠ” OauthIdë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ íšŒì›ì„ ì°¾ì•„ì˜µë‹ˆë‹¤.

ë§Œì•½ ê°€ì…ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ ì €ì¥(íšŒì›ê°€ì…)í•©ë‹ˆë‹¤.

ì›ë˜ëŠ” JWTë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì—¬ê¸°ì„œ JWTë¡œ AccessTokenì„ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ì—¬ì•¼ í•˜ì§€ë§Œ, JWTê¹Œì§€ ë‹¤ë£¨ê¸°ì—ëŠ” ì´ë¯¸ ë¶„ëŸ‰ì´ ë„ˆë¬´ ë§ìœ¼ë¯€ë¡œ Idë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ì €í˜¼ì íƒ€í˜‘í•˜ê³  ë„˜ì–´ê°”ì—ˆìŠµë‹ˆë‹¤ :)

ì´ì œ ì´ë¥¼ Controllerì—ì„œ ì‚¬ìš©í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

<br />
<br />
<br />

### âœ¨ OauthController

```java
package mallang.oauth.presentation;

import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.SneakyThrows;
import mallang.oauth.application.OauthService;
import mallang.oauth.domain.OauthServerType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RequiredArgsConstructor
@RequestMapping("/oauth")
@RestController
public class OauthController {

    private final OauthService oauthService;

    @SneakyThrows
    @GetMapping("/{oauthServerType}")
    ResponseEntity<Void> redirectAuthCodeRequestUrl(
            @PathVariable OauthServerType oauthServerType,
            HttpServletResponse response
    ) {
        String redirectUrl = oauthService.getAuthCodeRequestUrl(oauthServerType);
        response.sendRedirect(redirectUrl);
        return ResponseEntity.ok().build();
    }

    // ì¶”ê°€
    @GetMapping("/login/{oauthServerType}")
    ResponseEntity<Long> login(
            @PathVariable OauthServerType oauthServerType,
            @RequestParam("code") String code
    ) {
        Long login = oauthService.login(oauthServerType, code);
        return ResponseEntity.ok(login);
    }
}
```

ë„ˆë¬´ ê¸¸ì–´ì ¸ì„œ ê¹Œë¨¹ìœ¼ì…¨ì„ ìˆ˜ë„ ìˆê² ì§€ë§Œ, ì‚¬ìš©ìê°€ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë¡œê·¸ì¸ + ì •ë³´ ì œê³µ ë™ì˜ë¥¼ ì§„í–‰í•˜ë©´ í”„ë¡ íŠ¸ì—”ë“œë¡œ Redirectë˜ë©°, í”„ë¡ íŠ¸ì—”ë“œëŠ” ì´ë•Œ codeë¥¼ ë°›ì•„ì„œ http://localhost:8080**/oauth/login/kakao**ë¡œ ë³´ë‚´ê¸°ë¡œ í–ˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ ì½”ë“œëŠ” KakaoRedirectPage.jsì— ìˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />

```js
import React, { useEffect } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import axios from "axios";

const KakaoRedirectPage = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const handleOAuthKakao = async (code) => {
    try {
      // ì¹´ì¹´ì˜¤ë¡œë¶€í„° ë°›ì•„ì˜¨ codeë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ì—¬ ì¹´ì¹´ì˜¤ë¡œ íšŒì›ê°€ì… & ë¡œê·¸ì¸í•œë‹¤
      const response = await axios.get(
        `http://localhost:8080/oauth/login/kakao?code=${code}`
      );
      const data = response.data; // ì‘ë‹µ ë°ì´í„°
      alert("ë¡œê·¸ì¸ ì„±ê³µ: " + data);
      navigate("/success");
    } catch (error) {
      navigate("/fail");
    }
  };

  useEffect(() => {
    const searchParams = new URLSearchParams(location.search);
    const code = searchParams.get("code"); // ì¹´ì¹´ì˜¤ëŠ” Redirect ì‹œí‚¤ë©´ì„œ codeë¥¼ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì¤€ë‹¤.
    if (code) {
      alert("CODE = " + code);
      handleOAuthKakao(code);
    }
  }, [location]);

  return (
    <div>
      <div>Processing...</div>
    </div>
  );
};

export default KakaoRedirectPage;
```

ì´ë ‡ê²Œ ë˜ë©´ ì¹´ì¹´ì˜¤í†¡ íšŒì›ê°€ì…&ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„ì´ ì™„ë£Œë©ë‹ˆë‹¤.

í•œë²ˆ í…ŒìŠ¤íŠ¸ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

http://localhost:3000ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![sample6](./kakao_sample6.png)

ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì§„í–‰í•©ë‹ˆë‹¤

<br />
<br />.

![sample7](./kakao_sample7.png)

ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.

<br />
<br />

![sample8](./kakao_sample8.png)

Auth Codeë¥¼ ì˜ ë°›ì•„ì˜¤ëŠ” ê²ƒ ê¹Œì§€ëŠ” ì´ì „ì— í™•ì¸í–ˆìŠµë‹ˆë‹¤.

í™•ì¸ì„ ëˆ„ë¥´ê³  ì„œë²„ ë¡œê·¸ë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<br />
<br />

![sample9](./kakao_sample9.png)

íšŒì›ê°€ì…ì´ ì•„ì£¼ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

<br />
<br />

![sample10](./kakao_sample10.png)

ì´ë ‡ê²Œ í•´ì„œ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

<br />
<br />
<br />
<br />
<br />

## ğŸ§ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•

ì§€ê¸ˆê¹Œì§€ì˜ ì½”ë“œë¥¼ í†µí•´ Oauth ë¡œê·¸ì¸ì˜ ê¸°ë³¸ êµ¬ì¡°ê°€ ê°–ì¶”ì–´ì¡ŒìŠµë‹ˆë‹¤.<br/>
ì´ì œ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•œ ê³¼ì •ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.<br/>
ë„¤ì´ë²„ë¥¼ ì˜ˆì‹œë¡œ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ 1. ê°œë°œì ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€

ë„¤ì´ë²„ë¼ë©´ ë„¤ì´ë²„ ê°œë°œì ì‚¬ì´íŠ¸([https://developers.naver.com/apps/#/list](https://developers.naver.com/apps/#/list))ë¡œ ì´ë™í•˜ì—¬, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³  ì„¤ì •í•©ë‹ˆë‹¤.<br/>

ì´ë•Œ redirect_urië¥¼ ë“±ë¡í•  ë•Œì—ëŠ” **http://localhost:3030/oauth/redirected**/{**ì„œë¹„ìŠ¤ ë³„ì¹­**?(kakao, naver, google ë“± ì„ì˜ë¡œ ì •ì˜)}ì˜ í˜•ì‹ìœ¼ë¡œ ë“±ë¡í•´ì¤ë‹ˆë‹¤.

ì°¸ê³ ë¡œ http://localhost:3000 ê°™ì€ ê²½ìš°, ë‹¹ì—°íˆ ë°°í¬ì‹œì—ëŠ” ë°°í¬ëœ ì„œë²„ì˜ ë„ë©”ì¸ì„ ì…ë ¥í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

ê°™ì´ í•´ë³´ê² ìŠµë‹ˆë‹¤.

<br />
<br />

ë„¤ì´ë²„ ê°œë°œì ì‚¬ì´íŠ¸([https://developers.naver.com/apps/#/list](https://developers.naver.com/apps/#/list))ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![naver1](./naver_1.png)

Application ë“±ë¡ì„ í´ë¦­í•©ë‹ˆë‹¤.

<br />
<br />

![naver2](./naver_2.png)

ìœ„ì™€ ê°™ì´ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

ì´ë•Œ CallbackUrlì€ ì¹´ì¹´ì˜¤ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ, ë§ˆì§€ë§‰ì´ kakaoê°€ ì•„ë‹Œ naverë¡œ ë³€ê²½ë˜ì—ˆë‹¤ëŠ” ì ë§Œ ë‹¤ë¦…ë‹ˆë‹¤.

<br />
<br />

![naver3](./naver_3.png)

ìœ„ ë‘ê°œë¥¼ ì–´ë”˜ê°€ì— ì €ì¥í•´ë‘¡ë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ 2. OauthServerTypeì— ì„œë¹„ìŠ¤ ì¶”ê°€

```java
public enum OauthServerType {

    KAKAO,
    NAVER,
    ;

    public static OauthServerType fromName(String type) {
        return OauthServerType.valueOf(type.toUpperCase(ENGLISH));
    }
}
```

ê·¸ëƒ¥ ì´ë¦„ì— ë§ê²Œ ì¶”ê°€í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

<br />
<br />
<br />

### ğŸ³ 3. application.ymlì— ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ë³´ ë“±ë¡

```yml
oauth:
  kakao:
    client_id: ${KAKAO_CLIENT_ID}
    redirect_uri: ${KAKAO_REDIRECT_URI}
    client_secret: ${KAKAO_CLIENT_SECRET}
    scope: ${KAKAO_SCOPE}

  naver:
    client_id: ${NAVER_CLIENT_ID}
    redirect_uri: ${NAVER_REDIRECT_URI}
    client_secret: ${NAVER_CLIENT_SECRET}
    scope: ${NAVER_SCOPE}
```

1ë²ˆì—ì„œ ì„¤ì •í•œ client_id, secret, redirect_uri, , scope(ì—†ìœ¼ë©´ ê³µë°±)ë¥¼ ë“±ë¡í•´ì¤ë‹ˆë‹¤.

í•´ë‹¹ ì„¤ì • ì •ë³´ í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•©ë‹ˆë‹¤.

```java
package mallang.oauth.infra.oauth.naver;

import org.springframework.boot.context.properties.ConfigurationProperties;

@ConfigurationProperties(prefix = "oauth.naver")
public record NaverOauthConfig(
        String redirectUri,
        String clientId,
        String clientSecret,
        String[] scope,
        String state
) {
}
```

<br />
<br />
<br />

### ğŸ³ 4. AuthCodeRequestUrlProvider êµ¬í˜„

#### ğŸš€ Auth Code ë°œê¸‰ API ëª…ì„¸

Auth Codeì™€ AccessToken ê´€ë ¨ API ëª…ì„¸ëŠ”ì€ [í•´ë‹¹ ë§í¬](https://developers.naver.com/docs/login/api/api.md#2--api-%EA%B8%B0%EB%B3%B8-%EC%A0%95%EB%B3%B4)ì— ìˆìŠµë‹ˆë‹¤.

![naver4](./naver_4.png)
![naver5](./naver_5.png)
![naver6](./naver_6.png)

<br />
<br />
<br />

ì´ì— ë§ê²Œ êµ¬í˜„í•©ë‹ˆë‹¤.

```java
package mallang.oauth.infra.oauth.naver.authcode;

import lombok.RequiredArgsConstructor;
import mallang.oauth.domain.OauthServerType;
import mallang.oauth.domain.authcode.AuthCodeRequestUrlProvider;
import mallang.oauth.infra.oauth.naver.NaverOauthConfig;
import org.springframework.stereotype.Component;
import org.springframework.web.util.UriComponentsBuilder;

@Component
@RequiredArgsConstructor
public class NaverAuthCodeRequestUrlProvider implements AuthCodeRequestUrlProvider {

    private final NaverOauthConfig naverOauthConfig;

    @Override
    public OauthServerType supportServer() {
        return OauthServerType.NAVER;
    }

    @Override
    public String provide() {
        return UriComponentsBuilder
                .fromUriString("https://nid.naver.com/oauth2.0/authorize")
                .queryParam("response_type", "code")
                .queryParam("client_id", naverOauthConfig.clientId())
                .queryParam("redirect_uri", naverOauthConfig.redirectUri())
                .queryParam("state", "samplestate") // ì´ê±´ ë‚˜ì¤‘ì— ë”°ë¡œ ì°¾ì•„ë³´ê³  ì„¤ì •í•´ì„œ ì“°ì„¸ìš©!
                .build()
                .toUriString();
    }
}
```

<br />
<br />
<br />
<br />

### ğŸ³ 5. AccessToken ë°œê¸‰ & íšŒì› ì •ë³´ ì¡°íšŒ API Cleint êµ¬í˜„

### ğŸš€ AcessToken ë°œê¸‰ API ëª…ì„¸

AccessToken ê´€ë ¨ë„ [í•´ë‹¹ ë§í¬](https://developers.naver.com/docs/login/api/api.md#2--api-%EA%B8%B0%EB%B3%B8-%EC%A0%95%EB%B3%B4)ì— ìˆìŠµë‹ˆë‹¤.

![naver7](./naver_7.png)
![naver8](./naver_8.png)
![naver9](./naver_9.png)

<br />
<br />

### ğŸš€íšŒì› ì •ë³´ ì¡°íšŒ API ëª…ì„¸

íšŒì› ì •ë³´ ì¡°íšŒëŠ” [í•´ë‹¹ ë§í¬](https://developers.naver.com/docs/login/profile/profile.md)ì— ì¡´ì¬í•©ë‹ˆë‹¤.

![naver10](./naver_10.png)
![naver11](./naver_11.png)
![naver12](./naver_12.png)

<br />
<br />
<br />

ì´ì— ë§ê²Œ êµ¬í˜„í•©ë‹ˆë‹¤.

```java
package mallang.oauth.infra.oauth.naver.client;

import static org.springframework.http.HttpHeaders.AUTHORIZATION;

import mallang.oauth.infra.oauth.naver.dto.NaverMemberResponse;
import mallang.oauth.infra.oauth.naver.dto.NaverToken;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.service.annotation.GetExchange;
import org.springframework.web.service.annotation.PostExchange;

public interface NaverApiClient {

    @PostExchange(url = "https://nid.naver.com/oauth2.0/token")
    NaverToken fetchToken(@RequestParam MultiValueMap<String, String> params);

    @GetExchange("https://openapi.naver.com/v1/nid/me")
    NaverMemberResponse fetchMember(@RequestHeader(name = AUTHORIZATION) String bearerToken);
}
```

<br />
<br />
<br />

```java
package mallang.oauth.infra.oauth.naver.dto;

import com.fasterxml.jackson.databind.PropertyNamingStrategies.SnakeCaseStrategy;
import com.fasterxml.jackson.databind.annotation.JsonNaming;

@JsonNaming(value = SnakeCaseStrategy.class)
public record NaverToken(
        String accessToken,
        String refreshToken,
        String tokenType,
        Integer expiresIn,
        String error,
        String errorDescription
) {
}
```

<br />
<br />
<br />

```java
package mallang.oauth.infra.oauth.naver.dto;

import static mallang.oauth.domain.OauthServerType.NAVER;

import com.fasterxml.jackson.databind.PropertyNamingStrategies.SnakeCaseStrategy;
import com.fasterxml.jackson.databind.annotation.JsonNaming;
import mallang.oauth.domain.OauthId;
import mallang.oauth.domain.OauthMember;

@JsonNaming(value = SnakeCaseStrategy.class)
public record NaverMemberResponse(
        String resultcode,
        String message,
        Response response
) {

    public OauthMember toDomain() {
        return OauthMember.builder()
                .oauthId(new OauthId(String.valueOf(response.id), NAVER))
                .nickname(response.nickname)
                .profileImageUrl(response.profileImage)
                .build();
    }

    @JsonNaming(value = SnakeCaseStrategy.class)
    public record Response(
            String id,
            String nickname,
            String name,
            String email,
            String gender,
            String age,
            String birthday,
            String profileImage,
            String birthyear,
            String mobile
    ) {
    }
}
```

ê·¸ë¦¬ê³  HttpInterfaceConfigì— ë¹ˆìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.

<br />
<br />
<br />

```java
package mallang.oauth.infra.oauth.config;

import mallang.oauth.infra.oauth.kakao.client.KakaoApiClient;
import mallang.oauth.infra.oauth.naver.client.NaverApiClient;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.reactive.function.client.WebClient;
import org.springframework.web.reactive.function.client.support.WebClientAdapter;
import org.springframework.web.service.invoker.HttpServiceProxyFactory;

@Configuration
public class HttpInterfaceConfig {

    @Bean
    public KakaoApiClient kakaoApiClient() {
        return createHttpInterface(KakaoApiClient.class);
    }

    @Bean
    public NaverApiClient naverApiClient() {
        return createHttpInterface(NaverApiClient.class);
    }

    private <T> T createHttpInterface(Class<T> clazz) {
        WebClient webClient = WebClient.create();
        HttpServiceProxyFactory build = HttpServiceProxyFactory
                .builder(WebClientAdapter.forClient(webClient)).build();
        return build.createClient(clazz);
    }
}
```

<br />
<br />
<br />

### ğŸ³ 6. OauthMemberClient êµ¬í˜„

```java
package mallang.oauth.infra.oauth.naver;

import lombok.RequiredArgsConstructor;
import mallang.oauth.domain.OauthMember;
import mallang.oauth.domain.OauthServerType;
import mallang.oauth.domain.client.OauthMemberClient;
import mallang.oauth.infra.oauth.naver.client.NaverApiClient;
import mallang.oauth.infra.oauth.naver.dto.NaverMemberResponse;
import mallang.oauth.infra.oauth.naver.dto.NaverToken;
import org.springframework.stereotype.Component;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;

@Component
@RequiredArgsConstructor
public class NaverMemberClient implements OauthMemberClient {

    private final NaverApiClient naverApiClient;
    private final NaverOauthConfig naverOauthConfig;

    @Override
    public OauthServerType supportServer() {
        return OauthServerType.NAVER;
    }

    @Override
    public OauthMember fetch(String authCode) {
        NaverToken tokenInfo = naverApiClient.fetchToken(tokenRequestParams(authCode));
        NaverMemberResponse naverMemberResponse = naverApiClient.fetchMember("Bearer " + tokenInfo.accessToken());
        return naverMemberResponse.toDomain();
    }

    private MultiValueMap<String, String> tokenRequestParams(String authCode) {
        MultiValueMap<String, String> params = new LinkedMultiValueMap<>();
        params.add("grant_type", "authorization_code");
        params.add("client_id", naverOauthConfig.clientId());
        params.add("client_secret", naverOauthConfig.clientSecret());
        params.add("code", authCode);
        params.add("state", naverOauthConfig.state());
        return params;
    }
}
```

ì´ëŸ¬ë©´ ë„¤ì´ë²„ ë¡œê·¸ì¸ë„ êµ¬í˜„ì´ ëë‚©ë‹ˆë‹¤.

<br />
<br />
<br />
<br />

## ğŸ§ ë„¤ì´ë²„ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ í”„ë¡ íŠ¸ì—”ë“œì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```js
import React, { useEffect } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import axios from "axios";

const NaverRedirectPage = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const handleOAuthKakao = async (code) => {
    try {
      // ë„¤ì´ë²„ë¡œë¶€í„° ë°›ì•„ì˜¨ codeë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ì—¬ ì¹´ì¹´ì˜¤ë¡œ íšŒì›ê°€ì… & ë¡œê·¸ì¸í•œë‹¤
      const response = await axios.get(
        `http://localhost:8080/oauth/login/naver?code=${code}`
      );
      const data = response.data; // ì‘ë‹µ ë°ì´í„°
      alert("ë¡œê·¸ì¸ ì„±ê³µ: " + data);
      navigate("/success");
    } catch (error) {
      navigate("/fail");
    }
  };

  useEffect(() => {
    const searchParams = new URLSearchParams(location.search);
    const code = searchParams.get("code"); // ë„¤ì´ë²„ëŠ” Redirect ì‹œí‚¤ë©´ì„œ codeë¥¼ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì¤€ë‹¤.
    if (code) {
      alert("CODE = " + code);
      handleOAuthKakao(code);
    }
  }, [location]);

  return (
    <div>
      <div>Processing...</div>
    </div>
  );
};

export default NaverRedirectPage;
```

kakaoì™€ ë¹„êµí•´ì„œ axios.getì˜ urlì˜ ë§ˆì§€ë§‰ ë¶€ë¶„ì´ kakao ì—ì„œ naverë¡œë§Œ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤.

(ë” ì´ì˜ê²Œ í•  ìˆ˜ ìˆì—ˆì„ ê±° ê°™ì€ë°, ì œê°€ í”„ë¡ íŠ¸ í•  ì¤„ì„ ëª°ë¼ì„œ ê·¸ëƒ¥ ì´ë ‡ê²Œ ì¤‘ë³µ ë§Œë“¤ê²Œìš”..ã… )

ê·¸ë¦¬ê³  ë¼ìš°íŒ…ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

<br />
<br />
<br />

```js
import { BrowserRouter, Routes, Route } from "react-router-dom";
import LoginPage from "./LoginPage";
import KakaoRedirectPage from "./KakaoRedirectPage";
import NaverRedirectPage from "./NaverRedirectPage";

const App = () => {
  return (
    <div className="App">
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<LoginPage />}></Route>
          <Route
            path="/oauth/redirected/kakao"
            element={<KakaoRedirectPage />}
          ></Route>
          <Route
            path="/oauth/redirected/naver"
            element={<NaverRedirectPage />}
          ></Route>
        </Routes>
      </BrowserRouter>
    </div>
  );
};

export default App;
```

ë©”ì¸ ë¡œê·¸ì¸ í˜ì´ì§€ë„ ë²„íŠ¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

<br />
<br />
<br />

```js
import React from "react";

const LoginPage = () => {
  const handleKakaoLoginClick = () => {
    window.location.href = "http://localhost:8080/oauth/kakao";
  };

  const handleNaverLoginClick = () => {
    window.location.href = "http://localhost:8080/oauth/naver"; // Replace with your Naver login URL
  };

  return (
    <div
      style={{
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        height: "100vh",
      }}
    >
      <div>
        <button
          onClick={handleKakaoLoginClick}
          style={{
            padding: "10px 20px",
            fontSize: "18px",
            borderRadius: "5px",
            cursor: "pointer",
            marginRight: "10px",
          }}
        >
          ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸
        </button>
        <button
          onClick={handleNaverLoginClick}
          style={{
            padding: "10px 20px",
            fontSize: "18px",
            borderRadius: "5px",
            cursor: "pointer",
          }}
        >
          ë„¤ì´ë²„ ë¡œê·¸ì¸
        </button>
      </div>
    </div>
  );
};

export default LoginPage;
```

<br />
<br />
<br />

ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.

![naver sample1](./naver_sample1.png)

<br />

![naver sample2](./naver_sample2.png)

<br />

![naver sample3](./naver_sample3.png)

<br />

![naver sample4](./naver_sample4.png)

<br />

![naver sample5](./naver_sample5.png)

<br />

![naver sample6](./naver_sample6.png)

<br />

ì´ë ‡ê²Œ í•´ì„œ ì •ë§ ê°„ë‹¨í•˜ê²Œ Naver ë¡œê·¸ì¸ë„ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
