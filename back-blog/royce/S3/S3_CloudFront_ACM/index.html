<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-back-blog">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">안전한 S3 버킷 정책 설정하기 | Celuveat</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://celuveat.github.io/team-blog/back-blog/royce/S3/S3_CloudFront_ACM"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="안전한 S3 버킷 정책 설정하기 | Celuveat"><meta data-rh="true" name="description" content="CloudFront와 ACM으로 버킷 접근 제어하기"><meta data-rh="true" property="og:description" content="CloudFront와 ACM으로 버킷 접근 제어하기"><meta data-rh="true" name="keywords" content="인프라,S3,CloudFront"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-31T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/taeyeonroyce"><meta data-rh="true" property="article:tag" content="S3,CloudFront,인프라"><link data-rh="true" rel="icon" href="/team-blog/../static/img/logo/favicon.ico"><link data-rh="true" rel="canonical" href="https://celuveat.github.io/team-blog/back-blog/royce/S3/S3_CloudFront_ACM"><link data-rh="true" rel="alternate" href="https://celuveat.github.io/team-blog/back-blog/royce/S3/S3_CloudFront_ACM" hreflang="ko"><link data-rh="true" rel="alternate" href="https://celuveat.github.io/team-blog/back-blog/royce/S3/S3_CloudFront_ACM" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-DBVZBC9QT5","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DBVZBC9QT5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DBVZBC9QT5",{anonymize_ip:!0})</script>


<link rel="alternate" type="application/rss+xml" href="/team-blog/back-blog/rss.xml" title="Celuveat RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/team-blog/back-blog/atom.xml" title="Celuveat Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/team-blog/front-blog/rss.xml" title="Celuveat RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/team-blog/front-blog/atom.xml" title="Celuveat Atom Feed"><link rel="stylesheet" href="/team-blog/assets/css/styles.6a887e90.css">
<link rel="preload" href="/team-blog/assets/js/runtime~main.6d39a248.js" as="script">
<link rel="preload" href="/team-blog/assets/js/main.7ad60637.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/team-blog/"><div class="navbar__logo"><img src="/team-blog/img/logo/logo-black.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/team-blog/img/logo/logo-white.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/team-blog/front-blog">프론트엔드</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/team-blog/back-blog">백엔드</a><a class="navbar__item navbar__link" href="/team-blog/docs/셀럽잇">팀 문서</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/celuveat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/team-blog/back-blog/royce/S3/S3_CloudFront_ACM">안전한 S3 버킷 정책 설정하기</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/doggy/KakaoOAuthLogout/KakaoOauthLogout">Oauth 로그아웃 - 카카오</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/royce/monitoring/monitoring-1">모니터링 시스템 구축기(1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/royce/monitoring2/monitoring-2">모니터링 시스템 구축기(2)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/royce/monitoring3/monitoring-3">모니터링 시스템 구축기(3)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">안전한 S3 버킷 정책 설정하기</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-31T00:00:00.000Z" itemprop="datePublished">2023년 8월 31일</time> · <!-- -->약 14분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/taeyeonroyce" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/90550065?v=4" alt="Royce Won"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/taeyeonroyce" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Royce Won</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>CloudFront와 ACM으로 S3 안전하게 사용하기</p><h1>CloudFront와 ACM으로 S3 안전하게 사용하기</h1><p>안녕하세요, 셀럽잇의 로이스입니다.</p><p>저희 셀럽잇 서비스에선 셀럽들이 다녀온 다양한 음식점에 대한 정보들을 제공합니다.</p><blockquote><p><a href="http://www.celuveat.com" target="_blank" rel="noopener noreferrer">www.celuveat.com</a></p><p><img loading="lazy" alt="1" src="/team-blog/assets/images/1-13de73f916d44c004f55a86dcffcf074.jpeg" width="1672" height="1037" class="img_ev3q"></p></blockquote><p>보시는 것과 같이 음식점과 관련한 다양한 사진 파일들도 제공하고 있습니다.</p><p>현재, 어플리케이션을 운영중인 서버에 해당 대략 600개의 이미지 파일들을 저장하여 관리하고 있는데요.
더 다양한 음식점과 해당 음식점과 관련한 사진들을 지속적으로 추가할 예정이며,
사용자들의 사진 리뷰 기능이 추가될 계획에 따라 더 많은 이미지 파일들이 추가 될 수 있습니다.</p><p>이러한 상황에서 현재 방식(운영서버에서의 이미지 파일 저장 및 관리)은 이미지 파일이 지속적으로 적재되면서 <strong>운영서버의 디스크가 부족</strong>해질 수 있으며,
수많은 <strong>이미지를 운영서버 내에서 관리</strong>해야 한다는 문제점이 있습니다.
또, 이미지 요청마다 비교적 성능이 저조한 디스크로의 접근이 자주 발생하여 동일한 서버에서 운영중인 어플리케이션에도 영향을 끼칠 수 있습니다.</p><h1>S3</h1><p>위와 같은 문제를 해결하기 위해 AWS에서 제공하는 <strong>S3</strong>(<strong>S</strong>imple Storage <strong>S</strong>ervice)를 사용하여 운영서버에서 이미지 파일로 인한 리소스 낭비와 관리 포인트를 분리하고자 합니다.</p><p>S3는 인터넷 스토리지 서비스로, 정적 파일들과 스크립트, 이미지, 음원, 바이너리 패키지등을 저장하는 관리하는 용도로 사용됩니다.</p><p>용량은 가용적으로 늘어나 무제한으로 사용 할 수 있으며, 직접적인 스케일링 작업이 필요하지 않습니다.
이러한 파일들의 업로드 혹은 삭제와 같은 작업을 <code>http/https</code>프로토콜을 통해 관리할 수 있습니다.
또한, ec2의 스토리지(ebs)를 사용하여 데이터를 저장하는 것보다 비용이 월등히 저렴합니다.</p><blockquote><p><em>EBS 볼륨 pricing</em></p><p><img loading="lazy" alt="2" src="/team-blog/assets/images/2-b3ac473b353fbd32779209b1366ed56b.jpeg" width="1200" height="639" class="img_ev3q"></p><p>S3 볼륨 pricing</p><p><img loading="lazy" alt="3" src="/team-blog/assets/images/3-e8c9f22064420cd584dc722be7378209.jpeg" width="1157" height="774" class="img_ev3q"></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="s3-버킷-생성">S3 버킷 생성<a href="#s3-버킷-생성" class="hash-link" aria-label="S3 버킷 생성에 대한 직접 링크" title="S3 버킷 생성에 대한 직접 링크">​</a></h2><p>S3에서는 스토리지의 최상위 디렉토리를 <strong>버킷(Bucket)</strong>이라고 합니다.
S3에 저장되는 데이터의 최소 단위를 <strong>객체(Object)</strong>라고 합니다.</p><p>이미지 저장을 위해 AWS에서 버킷을 생성하겠습니다.</p><blockquote><p>먼저 버킷의 이름을 지정합니다.</p><p><img loading="lazy" alt="4" src="/team-blog/assets/images/4-426c327238f710c19b6ec10022afe90a.jpeg" width="863" height="821" class="img_ev3q"></p><p>ACLs(Access Control Lists)은 비활성화 해둡니다.</p></blockquote><blockquote><p>빠른 접근을 위해 public access를 모두 허용합니다.
‼️<strong>(보안적으로 매우 취약한 설정입니다. 우선 이미지 업로드를 살펴본 후, 보안과 관련된 부분에 대해 설명하며 해결할 예정이니 따라하지 않으셔도 됩니다.)</strong></p><p><img loading="lazy" alt="5" src="/team-blog/assets/images/5-e1e72f14c30bcfff2b47c3914a3d84e6.jpeg" width="863" height="737" class="img_ev3q"></p></blockquote><blockquote><p>생성된 버킷에 접속합니다</p><p><img loading="lazy" alt="6" src="/team-blog/assets/images/6-aa28d9b461c7a15b7c81b3cbd16f9d2d.jpeg" width="945" height="389" class="img_ev3q"></p></blockquote><blockquote><p>이미지 파일을 하나 업로드 합니다.</p><p><img loading="lazy" alt="7" src="/team-blog/assets/images/7-5db72e3a1de409de4d5c24d20e20f8fd.jpeg" width="878" height="861" class="img_ev3q"></p></blockquote><blockquote><p>객체 URL을 선택하여 해당 객체에 접근합니다.</p><p><img loading="lazy" alt="8" src="/team-blog/assets/images/8-c3f8034380bae4fd5cb6c91ee9ba90b6.jpeg" width="1315" height="675" class="img_ev3q"></p></blockquote><blockquote><p>그럼 아래와 같이 Access Denied가 발생하는데요.</p><p><img loading="lazy" alt="9" src="/team-blog/assets/images/9-48f3a5519432b0286db66c1a25a58cec.jpeg" width="1009" height="419" class="img_ev3q"></p><p>버킷 정책을 설정해주지 않아서 발생하는 현상입니다.</p></blockquote><blockquote><p>버킷 설정으로 들어가 정책을 설정해보겠습니다.</p><p><img loading="lazy" alt="10" src="/team-blog/assets/images/10-f830021ce270fc1131859398d04c3808.jpeg" width="1324" height="937" class="img_ev3q"></p><p><img loading="lazy" alt="11" src="/team-blog/assets/images/11-771713a21748dbd5835cf420ac70ae3e.jpeg" width="1324" height="944" class="img_ev3q"></p></blockquote><blockquote><p>정책 생성기에서 아래와 같이 설정하여 생성합니다.</p><p><img loading="lazy" alt="12" src="/team-blog/assets/images/12-ae7c732ef3e75ea7c2a10ceb93f31a9e.jpeg" width="1324" height="944" class="img_ev3q"></p><ul><li>[1]<!-- --> <strong>Select Type of Policy</strong>: <code>S3 Buckey Policy 선택</code></li><li>[2]<!-- --> <strong>Principal</strong>: <code>*</code></li><li>[3]<!-- --> <strong>Actions</strong>: <code>GetObject 선택</code></li><li>[4]<!-- --> <strong>Amazon Resource Name (ARN)</strong>: <code>arn:aws:s3:::{버킷이름}/*</code> (arn은 bucket properties에서 확인 할 수 있습니다)</li><li>[5]<!-- --> 정책 생성</li></ul></blockquote><blockquote><p>이후 생성된 정책을 복사하여 적용합니다.</p><p><img loading="lazy" alt="Screenshot 2023-09-01 at 0.00.04" src="/team-blog/assets/images/13-6405234b39dc03e09a6e0bbaef7c2e09.jpeg" width="1281" height="838" class="img_ev3q"></p></blockquote><p>다시 객체 URL로 접속하면 업로드한 이미지에 접근 할 수 있습니다!</p><p><img loading="lazy" alt="14" src="/team-blog/assets/images/14-1bb4e086c2e1bb88d54de51e21975192.jpeg" width="1909" height="664" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="보안-취약점">보안 취약점<a href="#보안-취약점" class="hash-link" aria-label="보안 취약점에 대한 직접 링크" title="보안 취약점에 대한 직접 링크">​</a></h2><p>위 방식으로 이미지를 업로드하고, 해당 url을 통해 객체에 접근 할 수 있게 되었습니다.</p><p>하지만 현재 S3는 보안적으로 굉장히 취약한 상태입니다.</p><p>우선, 데이터들이 저장되어있는 S3 버킷의 주소가 노출되어 있어 악성 공격에 굉장히 취약한 상태입니다.
또, 모든 액세스 요청에 대해 허용되어 있기 때문에 신뢰할 수 없는 클라이언트의 접근 역시 가능합니다.</p><p>실제로 S3와 관련하여 다양한 보안 이슈들이 존재한다고 합니다.</p><blockquote><ul><li><p><a href="https://www.theregister.com/2022/12/20/mcgraw_hills_s3_buckets_exposed/" target="_blank" rel="noopener noreferrer">잘못된 S3보안 정책으로 10만명 이상의 학생들의 정보 유출</a></p></li><li><p><a href="https://www.darkreading.com/application-security/cloud-misconfig-exposes-3tb-sensitive-airport-data-amazon-s3-bucket" target="_blank" rel="noopener noreferrer">3TB의 항공사 직원의 개인 신상 정보(PII)와 비행기, 연료 라인, GPS 좌표 등의 민감한 회사 데이터 노출</a></p></li></ul><p>출처: <a href="https://github.com/nagwww/s3-leaks" target="_blank" rel="noopener noreferrer">https://github.com/nagwww/s3-leaks</a></p></blockquote><p>현재의 S3 보안 정책에 대해 개선해야할 필요가 있습니다.</p><p>AWS에서는 CloudFront라는 CDN 서비스를 통해 버킷을 숨기고(OAI) 액세스를 강하게 제한하면서 S3버킷을 <a href="https://aws.amazon.com/ko/blogs/korea/amazon-s3-amazon-cloudfront-a-match-made-in-the-cloud/" target="_blank" rel="noopener noreferrer">사용하도록 권장</a>하고 있습니다.</p><p>그럼 간단하게 CDN에 대해 알아본 뒤, 좀 더 안전한 보안 정책을 수립해보겠습니다.</p><h1>CloudFront</h1><p>우선 CDN에 대해 간단하게 살펴보고 가겠습니다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cdncontent-delivery-network">CDN(Content Delivery Network)<a href="#cdncontent-delivery-network" class="hash-link" aria-label="CDN(Content Delivery Network)에 대한 직접 링크" title="CDN(Content Delivery Network)에 대한 직접 링크">​</a></h2><p>CDN은 사용자에게 빠르고 안전하게, 지리적 제약 없이 정적 콘텐츠를 제공하는할 수 있는 콘텐츠 전송 기술입니다.</p><p>CDN은 아래 사진과 같이 CDN 네트워크(캐시서버)를 구성하여 사용자의 요청에 대한 응답의 물리적인 거리를 줄여 콘텐츠 로딩에 소요되는 시간을 최소화합니다. 근접한 사용자의 요청에 원본 서버가 아닌 캐시 서버가 콘텐츠를 전달합니다.</p><blockquote><p>CDN없이 Origin 서버에서 서빙하는 경우<img loading="lazy" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2018/06/20/2-1-1024x543.jpg" alt="img" class="img_ev3q"></p></blockquote><blockquote><p>CDN을 통해 캐시 서버에서 서빙하는 경우</p><p><img loading="lazy" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2018/06/20/3-1024x559.jpg" alt="img" class="img_ev3q"></p></blockquote><p>이러한 CDN기술은 다음과 같은 장점이 있습니다.</p><ol><li>웹사이트 로딩 속도 개선</li><li>대역폭 사용 비용 절감</li><li>컨텐츠 제공의 안정성</li><li>웹사이트 보안</li></ol><p>특히, 응답 속도가 느린 이미지를 자주 제공하는 셀럽잇에서는 CDN을 통해 웹페이지 로딩 속도를 크게 개선 할 수 있습니다.</p><blockquote><p><em>CloudFront를 사용하면 지리적 제한, 서명된 URL, 서명된 쿠키 등 액세스 제한을 추가로 설정하여 기준이 서로 다른 콘텐츠에 대한 액세스 제한을 강화할 수 있습니다.</em> - AWS CloudFront</p></blockquote><p>그리고, CloudFront는 이런 CDN을 제공하는 AWS 서비스입니다.</p><p>CloudFront를 사용하여 S3버킷의 직접적인 접근을 막고 CloudFront를 통해서만 액세스가 가능하도록 구성한다면, 보안적인 취약점을 해결 할 수 있습니다.
AWS에서 제공하는 웹 방화벽인 WAF와 DDoS 보호 서비스인 AWS Shield 역시 CloudFront에 적용 가능하여 보안을 강화 할 수 있습니다.</p><p><img loading="lazy" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2018/06/27/4-v-2.png" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cloudfront-적용">CloudFront 적용<a href="#cloudfront-적용" class="hash-link" aria-label="CloudFront 적용에 대한 직접 링크" title="CloudFront 적용에 대한 직접 링크">​</a></h2><p>우선, 취약점 투성이인 S3의 정책을 강화하겠습니다.</p><p>열어두었던 Public access를 모두 막도록 수정하고, Bucket Policy도 제거합니다.</p><blockquote><p><img loading="lazy" alt="15" src="/team-blog/assets/images/15-33d94d6d80b9a71371e83b8db524cd1a.jpeg" width="1281" height="838" class="img_ev3q"></p><p><img loading="lazy" alt="16" src="/team-blog/assets/images/16-029f70fb1721b2eb8a06b4f8357f67d8.jpeg" width="1297" height="648" class="img_ev3q"></p></blockquote><p>이후 CloudFront를 생성하겠습니다.</p><blockquote><p>S3버킷을 설정 합니다<img loading="lazy" alt="17" src="/team-blog/assets/images/17-13ab3e9814b7d7c38482a67dd409d514.jpeg" width="993" height="956" class="img_ev3q"></p></blockquote><blockquote><p>이후, Origin access control settings를 선택하여 CloudFront를 통해서만 bucket에 접근하도록 합니다. 제어 설정도 추가합니다.</p><p><img loading="lazy" alt="18" src="/team-blog/assets/images/18-8f2cd226c11ef070855e77205b3fdfbb.jpeg" width="993" height="956" class="img_ev3q"></p><p><img loading="lazy" alt="19" src="/team-blog/assets/images/19-f152660f007515fee1220484a378d565.jpeg" width="601" height="604" class="img_ev3q"></p></blockquote><blockquote><p>다음 cache 동작에서 http 요청 모두 -&gt; https를 사용하도록 수정합니다.</p><p><img loading="lazy" alt="20" src="/team-blog/assets/images/20-2ed75eaea732563591a3affbb224ef42.jpeg" width="810" height="930" class="img_ev3q"></p><p>이번 적용에서는 WAF는 설정하지 않았습니다.</p><p><img loading="lazy" alt="21" src="/team-blog/assets/images/21-508205e8a639e064206c10b443dac01b.jpeg" width="810" height="930" class="img_ev3q"></p><p>위 구성으로 CloudFront를 생성합니다.</p></blockquote><p>생성이 완료되면 연결된 버킷과 관련하여 버킷 정책이 생성되는데, 이를 복사한 뒤 버킷 정책에 추가합니다.</p><p><img loading="lazy" alt="22" src="/team-blog/assets/images/22-4fa20d37e2b57aefa552a7234db4d022.jpeg" width="1636" height="413" class="img_ev3q"></p><p><img loading="lazy" alt="23" src="/team-blog/assets/images/23-80b0e1207d0f1ccc22e184cbe9730833.jpeg" width="925" height="517" class="img_ev3q"></p><p>이제 S3객체 url로 직접 access는 불가능 하고, <code>{arn}.cloudfront.net/{객체이름}</code>으로만 접근이 가능한 것을 확인 할 수 있습니다!</p><p><img loading="lazy" alt="Screenshot 2023-09-01 at 0.58.46" src="/team-blog/assets/images/23-80b0e1207d0f1ccc22e184cbe9730833.jpeg" width="925" height="517" class="img_ev3q"></p><h1>CloudFront 도메인 적용</h1><p>이제 CloudFront를 통해서만 S3버킷에 접근이 가능하도록 구성하였습니다.</p><blockquote><p><img loading="lazy" src="https://techblog.woowahan.com/wp-content/uploads/2021/11/OAI%EA%B0%9C%EB%85%90%EB%8F%84.png" alt="OAI" class="img_ev3q"></p><p>출처: <a href="https://techblog.woowahan.com/6217/" target="_blank" rel="noopener noreferrer">https://techblog.woowahan.com/6217/</a></p></blockquote><p>하지만 CloudFront의 서버주소가 노출되어 있습니다. 구매한 도메인을 사용해보도록 하겠습니다.</p><p>셀럽잇은 gabia에서 도메인을 구매하여 관리하고 있습니다.</p><p>현재 CloudFront의 도메인을 CNAME으로 gabia에 등록하여 노출되지 않도록 수정해보겠습니다.</p><p><img loading="lazy" alt="25" src="/team-blog/assets/images/25-d87b57142541e8e04a17a2726a3ca2a1.jpeg" width="708" height="98" class="img_ev3q"></p><p>전파가 된 이후, <code>image.celuveat.com/celuveat-logo.jpeg</code>에 접속해 보면 아래와 같이 403이 나옵니다...</p><p><img loading="lazy" alt="26" src="/team-blog/assets/images/26-02113ded31233c37faf5f8eebe01e64b.jpeg" width="1225" height="326" class="img_ev3q"></p><p>이는 CloudFront에선 허가되지 않은 CNAME 도메인에서의 접속을 차단하고 있기 때문입니다.</p><p>AWS의 Ceritication Manager를 통해 인증을 받아 해결 할 수 있습니다. (ACM에 대한 설명은 생략하겠습니다.)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="인증서-요청">인증서 요청<a href="#인증서-요청" class="hash-link" aria-label="인증서 요청에 대한 직접 링크" title="인증서 요청에 대한 직접 링크">​</a></h2><blockquote><p>CloudFront의 설정 수정에 들어간 뒤, SSL 인증서 요청을 클릭합니다.<img loading="lazy" alt="27" src="/team-blog/assets/images/27-58fc87c915f20d7c34cc32c0bdf39883.jpeg" width="836" height="808" class="img_ev3q"></p></blockquote><blockquote><p>public 인증서 요청을 선택 한 뒤,<img loading="lazy" alt="28" src="/team-blog/assets/images/28-b9cfda03b5470e16b2bdf2c6f5201d66.jpeg" width="1357" height="593" class="img_ev3q"></p><p>지정하고자 했던 도메인을 입력합니다. 이후 인증 방식을 선택 할 수 있습니다.</p><p><img loading="lazy" alt="29" src="/team-blog/assets/images/29-1b1c4d47b48344ac6cbb81d78f20a4e8.jpeg" width="1121" height="820" class="img_ev3q"></p></blockquote><p>DNS인증과 Email 인증 방식이 있습니다.</p><p>AWS의 root 계정이 아니라면, email 인증 방식에는 어려움이 있기 때문에 DNS방식을 선택하고 ssl 인증서를 생성합니다.</p><p><img loading="lazy" alt="30" src="/team-blog/assets/images/30-8bb23df1d8d703ec8739f95a8e48f5d5.jpeg" width="1324" height="666" class="img_ev3q"></p><p>그럼 아래와 같이 <code>CNAME name</code>과 <code>CNAME value</code>가 생성됩니다.</p><p>이 CNAME과 value를 DNS에 등록하여 <code>image.celuveat.com</code>의 도메인 관리자임을 인증받을 수 있습니다.</p><blockquote><p>만약 name이 <code>abcedasbfasens23_1212n.image.celuveat.com</code> 이고</p><p>value가 <code>sjbndgaou232asnwbjoasubaasn.acm-validations.aws.</code> 이라면,</p><p><img loading="lazy" alt="31" src="/team-blog/assets/images/31-7712590a23f126cc3e8d7963f53bbf71.jpeg" width="744" height="46" class="img_ev3q"></p><p>호스트에 <code>abcedasbfasens23_1212n.image</code>,</p><p>값/위치에는 <code>sjbndgaou232asnwbjoasubaasn.acm-validations.aws.</code> 을 넣어주면 됩니다.</p></blockquote><p>대략 몇분의 시간이 지난 뒤, Certificate status가 발행으로 변경됩니다! (저는 4분정도 걸렸습니다.)</p><p>이제 발급받은 ssl을 CloudFront에 적용하여 도메인으로 사용하도록 합시다!</p><p>CloudFront 편집에서 아래와 같이 <code>CNAME</code>을 입력하고, 인증받은 ssl을 선택합니다.</p><p><img loading="lazy" alt="32" src="/team-blog/assets/images/32-3f5431f66dc3f683feed41947ec107da.jpeg" width="779" height="776" class="img_ev3q"></p><p>CloudFront 배포가 완료되면, <code>https://image.celuveat.com/celuveat-logo.png</code>로 접근 가능합니다!</p><p><img loading="lazy" alt="33" src="/team-blog/assets/images/33-ce5187e0a97c58898a1660bc2416a07e.jpeg" width="1917" height="667" class="img_ev3q"></p><blockquote><p>참고</p><ul><li><a href="https://aws.amazon.com/ko/blogs/korea/amazon-s3-amazon-cloudfront-a-match-made-in-the-cloud/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/ko/blogs/korea/amazon-s3-amazon-cloudfront-a-match-made-in-the-cloud/</a></li><li><a href="https://www.youtube.com/watch?v=vgYfAndrpPU" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=vgYfAndrpPU</a></li><li><a href="https://sihyung92.oopy.io/devops/gabia/1" target="_blank" rel="noopener noreferrer">https://sihyung92.oopy.io/devops/gabia/1</a></li><li><a href="https://blog.pium.life/aws-s3-apply/" target="_blank" rel="noopener noreferrer">https://blog.pium.life/aws-s3-apply/</a></li></ul></blockquote></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/s-3">S3</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/cloud-front">CloudFront</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/인프라">인프라</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><a class="pagination-nav__link pagination-nav__link--next" href="/team-blog/back-blog/doggy/KakaoOAuthLogout/KakaoOauthLogout"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">Oauth 로그아웃 - 카카오</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#s3-버킷-생성" class="table-of-contents__link toc-highlight">S3 버킷 생성</a></li><li><a href="#보안-취약점" class="table-of-contents__link toc-highlight">보안 취약점</a></li><li><a href="#cdncontent-delivery-network" class="table-of-contents__link toc-highlight">CDN(Content Delivery Network)</a></li><li><a href="#cloudfront-적용" class="table-of-contents__link toc-highlight">CloudFront 적용</a></li><li><a href="#인증서-요청" class="table-of-contents__link toc-highlight">인증서 요청</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><span class="footer__link-item">
        Powered by <a href="https://docusaurus.io/" target="_blank" rel="noreferrer noopener">Docusaurus 2</a>, Hosted by <a href="https://github.com/" target="_blank" rel="noreferrer noopener">githubPages</a>
        <br>
        Copyright © 2023 <a href="https://github.com/pumpkiinbell" target="_blank" rel="noreferrer noopener">Celuveat</a>. All rights reserved.
        </span></div></div></div></footer></div>
<script src="/team-blog/assets/js/runtime~main.6d39a248.js"></script>
<script src="/team-blog/assets/js/main.7ad60637.js"></script>
</body>
</html>