<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-back-blog">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">셀럽잇 CI/CD 발전기 - (2) Git 서브모듈 도입 | Celuveat</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://celuveat.github.io/team-blog/back-blog/mallang/cicd-series/cicd-2/cicd2"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="셀럽잇 CI/CD 발전기 - (2) Git 서브모듈 도입 | Celuveat"><meta data-rh="true" name="description" content="셀럽잇 팀의 CI/CD 발전기"><meta data-rh="true" property="og:description" content="셀럽잇 팀의 CI/CD 발전기"><meta data-rh="true" name="keywords" content="CI/CD,인프라"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/shin-mallang"><meta data-rh="true" property="article:tag" content="CI/CD,인프라,Github Actions,git submodules"><link data-rh="true" rel="icon" href="/team-blog/../static/img/logo/favicon.ico"><link data-rh="true" rel="canonical" href="https://celuveat.github.io/team-blog/back-blog/mallang/cicd-series/cicd-2/cicd2"><link data-rh="true" rel="alternate" href="https://celuveat.github.io/team-blog/back-blog/mallang/cicd-series/cicd-2/cicd2" hreflang="ko"><link data-rh="true" rel="alternate" href="https://celuveat.github.io/team-blog/back-blog/mallang/cicd-series/cicd-2/cicd2" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-DBVZBC9QT5","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DBVZBC9QT5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DBVZBC9QT5",{anonymize_ip:!0})</script>


<link rel="alternate" type="application/rss+xml" href="/team-blog/back-blog/rss.xml" title="Celuveat RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/team-blog/back-blog/atom.xml" title="Celuveat Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/team-blog/front-blog/rss.xml" title="Celuveat RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/team-blog/front-blog/atom.xml" title="Celuveat Atom Feed"><link rel="stylesheet" href="/team-blog/assets/css/styles.6a887e90.css">
<link rel="preload" href="/team-blog/assets/js/runtime~main.cdea6afa.js" as="script">
<link rel="preload" href="/team-blog/assets/js/main.a6967bef.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/team-blog/"><div class="navbar__logo"><img src="/team-blog/img/logo/logo-black.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/team-blog/img/logo/logo-white.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/team-blog/front-blog">프론트엔드</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/team-blog/back-blog">백엔드</a><a class="navbar__item navbar__link" href="/team-blog/docs/셀럽잇">팀 문서</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/celuveat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/mallang/cicd-series/cicd-3/cicd3">셀럽잇 CI/CD 발전기 - (3-1) 백엔드의 docker와 github actions를 통한 배포 자동화</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/royce/submodule/submodule">Submodule 도입하기</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/team-blog/back-blog/mallang/cicd-series/cicd-2/cicd2">셀럽잇 CI/CD 발전기 - (2) Git 서브모듈 도입</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/mallang/oauth/oauth">OAuth2.0 도입기</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/team-blog/back-blog/mallang/cicd-series/cicd-1/cicd">셀럽잇 CI/CD 발전기 - (1) 쉘 스크립트를 통한 배포 자동화</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">셀럽잇 CI/CD 발전기 - (2) Git 서브모듈 도입</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-01T00:00:00.000Z" itemprop="datePublished">2023년 8월 1일</time> · <!-- -->약 9분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shin-mallang" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/52229930?v=4" alt="donghun Shin"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shin-mallang" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">donghun Shin</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>셀럽잇 CI/CD 발전기 - (2) Git 서브모듈 도입</p><br><br><br><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-서론">🧐 서론<a href="#-서론" class="hash-link" aria-label="🧐 서론에 대한 직접 링크" title="🧐 서론에 대한 직접 링크">​</a></h2><p>안녕하세요. 셀럽잇의 백엔드 말랑입니다.</p><p>3차 데모데이를 앞두고 프로덕션 서버를 준비하다 보니, 셀럽잇 팀의 CI/CD 방식에 변경 사항이 생겨서 이를 공유하기 위해 찾아왔습니다 😎</p><p>첫번째 변경점은 <strong>Git Submodule</strong>을 도입했다는 것입니다. <br></p><p>기능이 추가됨에 따라 <strong>Dev</strong> 환경과 <strong>Prod</strong> 환경에서 각각 설정해 주어야 하는 변수들이 많아지다 보니<br>
이들이 <strong>추가되거나 변경될 때마다</strong> 매번 <strong>서버에 들어가 배포 스크립트에 추가하고 수정</strong>해주는 작업이 많이 번거로웠습니다.<br>
또한 반드시 우테코 교육장에서만 ec2 서버에 ssh 로 접근을 할 수 있도록 설정되어있기 때문에, <strong>집에 간 상황에서 설정을 바꾸어 줄 방법이 없었습니다</strong>.</p><p>이러한 문제점을 해결하기 위해 저희는 <strong>Git Submodule</strong>을 도입했는데요,
서브모듈에 대한 기본적인 설명은 <a href="https://ttl-blog.tistory.com/1346" target="_blank" rel="noopener noreferrer">말랑이의 블로그</a>에 나와있으므로 해당 글에서는 생략하도록 하겠습니다.</p><p>대신 서브 모듈을 도입하면서 발생했던 이슈들을 해결하는 과정을 서술하겠습니다.</p><br><br><p>두번째 변경점은 <strong>프로덕션 서버를 위한 배포 스크립트가 작성</strong>된 것입니다. <br></p><p>이전 글에서 작성하지 않은 <strong>Prod 서버를 위한 CD workflow</strong> 설정을 중심적으로 살펴보고,<br>
하나의 Git Repository에서 <code>dev</code>와 <code>prod</code> 서버를 구분하여 배포하도록 설정하는 방법에 대해 살펴보겠습니다.</p><br><br><br><br><br><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-submodule-적용-트러블슈팅">🧐 Submodule 적용 트러블슈팅<a href="#-submodule-적용-트러블슈팅" class="hash-link" aria-label="🧐 Submodule 적용 트러블슈팅에 대한 직접 링크" title="🧐 Submodule 적용 트러블슈팅에 대한 직접 링크">​</a></h2><p>저희 팀은 CD를 <code>Github Actions Self-hosted Runners</code>를 통해 수행하는데요,
이때 Workflow를 다시 살펴보겠습니다.</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ✨ Celuveat backend DEV CD ✨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> develop</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;backend/**&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy-backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ✨ Run Backend Deploy Script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cd ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          sudo ./deploy-backend.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>마지막 부분을 보면 아시겠지만, <code>sudo</code>를 통해서 배포 스크립트를 실행하는데요, 이때 문제가 발생합니다.</p><p><a href="https://ttl-blog.tistory.com/1346" target="_blank" rel="noopener noreferrer">말랑이의 Git Submodule 설명 글</a>의
<a href="https://ttl-blog.tistory.com/1346#%F0%9F%A7%90%20EC2%EC%97%90%EC%84%9C%20Private%20Repository%EC%97%90%20%EB%8C%80%ED%95%9C%20%EC%9D%B8%EC%A6%9D%20%EB%AC%B8%EC%A0%9C%20%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0-1" target="_blank" rel="noopener noreferrer">EC2에서 Private Repository에 대한 인증 문제 해결하기</a>
부분을 보고 똑같이 적용하였는데, git submodule update를 하는 과정에서 <code>Permission denied (publickey)</code> 오류가 발생하였습니다.</p><p>이에 대한 원인을 찾아보니, git 에서 sudo 명령을 되도록 사용해서는 않는것을 권장한다고 하며,
<code>sudo 없이 ssh 키를 생성</code>한 다음 <code>sudo git push</code>와 같은 명령을 사용하면 <code>생성한 것과 동일한 키가 사용되지 않는다</code>고
<a href="https://docs.github.com/ko/authentication/troubleshooting-ssh/error-permission-denied-publickey" target="_blank" rel="noopener noreferrer">다음 문서</a>에 나와있었습니다.</p><br><br><br><br><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-왜-문제인가">🐳 왜 문제인가?<a href="#-왜-문제인가" class="hash-link" aria-label="🐳 왜 문제인가?에 대한 직접 링크" title="🐳 왜 문제인가?에 대한 직접 링크">​</a></h3><p><code>sudo</code> 명령을 통해 쉘 스크립트를 실행하게 되면, <code>쉘 스크립트에서 사용되는 모든 명령어</code>가 <code>sudo 권한</code>으로 실행되게 됩니다.</p><p>그런데 이때 배포 스크립트에는 다음 명령어가 존재했습니다.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...생략</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> submodule update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...생략</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>즉 위 명령이 실제로는 <code>sudo git submodule update</code>로 실행되는 것이었습니다.</p><p>EC2에서 Private repository에 대한 인증 처리를 위해 서브모듈의 URL을 <strong>ssh</strong>로 설정하였기에
<code>git submodule update</code>를 위해서는 <code>ssh key</code>가 필요한 상황이었습니다.</p><p>그러나 위 문서의 설명에 나와있듯이 <code>sudo 없이 ssh 키를 생성</code>한 다음 <code>sudo git update submodule</code> 명령어를 사용하였기에,
<code>생성한 것과 동일한 키가 사용되지 않아</code> 문제가 발생했던 것이었습니다.</p><br><br><br><br><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-어떻게-해결하나요">🐳 어떻게 해결하나요?<a href="#-어떻게-해결하나요" class="hash-link" aria-label="🐳 어떻게 해결하나요?에 대한 직접 링크" title="🐳 어떻게 해결하나요?에 대한 직접 링크">​</a></h3><p>간단합니다.
sudo 없이 ssh 키를 생성한 것이 문제였기 때문에, <code>sudo 명령어와 함께 ssh 키를 생성</code>해주면 됩니다.</p><p>이때 sudo 명령어로 생성된 키는 <code>cat ~/.ssh/id_rsa.pub</code>로는 바로 볼 수 없으며,</p><p><code>sudo su</code> 명령을 통해 root 계정으로 전환 후 <code>cat ~/.ssh/id_rsa.pub</code>를 실행해 주어야 합니다.
(해당 과정도 블로그 글에 업데이트 해두었으니, 상세한 설명은 블로그를 참조해주시면 감사하겠습니다.)</p><br><br><br><br><br><br><br><br><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-개발-서버dev와-프로덕션-서버prod의-배포-자동화하기">🧐 개발 서버(Dev)와 프로덕션 서버(Prod)의 배포 자동화하기<a href="#-개발-서버dev와-프로덕션-서버prod의-배포-자동화하기" class="hash-link" aria-label="🧐 개발 서버(Dev)와 프로덕션 서버(Prod)의 배포 자동화하기에 대한 직접 링크" title="🧐 개발 서버(Dev)와 프로덕션 서버(Prod)의 배포 자동화하기에 대한 직접 링크">​</a></h2><p>프로덕션 서버를 포함한 저희의 CI/CD 구조는 다음과 같습니다.
<img loading="lazy" alt="cicd" src="/team-blog/assets/images/cicd-78bd0ab8a510d5fe0ffd17c7c4ac3ca2.png" width="2454" height="1572" class="img_ev3q"></p><p>구조를 보면 알 수 있듯이, <code>develop-frontend</code> 브랜치와 <code>develop-backend</code> 브랜치에 PR이 Merge되면,<br>
<code>dev 서버</code>의 frontend와 backend의 배포 스크립트를 각각 실행시키는 방법을 사용하고 있습니다.</p><p>또한 <code>main</code> 브랜치에 PR이 Merge되면 <code>prod 서버</code>의 frontend와 backend의 배포 스크립트를 실행시킵니다.</p><p>이때 <code>dev 서버</code>와 <code>prod 서버</code> 모두 <code>self-hosted runners</code>를 각각 실행하고 있는 상태입니다.</p><p>이 상황에서 어떻게 <code>workflow</code>에 따라 특정 서버의 <code>self-hosted runners</code>만 실행할 수 있을까요? <br>
(더 정확히는 어떻게 <strong>PR이 Merge되는 브랜치에 따라</strong> 특정 <code>self-hosted runners</code>만 실행되도록 설정할 수 있을까요?)</p><br><br><br><br><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-runners-의-label-활용하기">🐳 Runners 의 Label 활용하기<a href="#-runners-의-label-활용하기" class="hash-link" aria-label="🐳 Runners 의 Label 활용하기에 대한 직접 링크" title="🐳 Runners 의 Label 활용하기에 대한 직접 링크">​</a></h3><p>(<a href="https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/using-self-hosted-runners-in-a-workflow#using-custom-labels-to-route-jobs" target="_blank" rel="noopener noreferrer">다음 문서</a>를 참고하여 설정하였습니다.)</p><p><code>Actions</code>의 <code>Runners</code>는 <code>Label</code>을 가질 수 있습니다.</p><p><img loading="lazy" alt="label" src="/team-blog/assets/images/runner-label-ad69c0cc751c49fc6475edd751c34bc8.png" width="1350" height="883" class="img_ev3q"></p><p>위 사진과 같이, 저희는 dev 서버와 prod 서버의 Runner 에 대하여, 각각 <code>dev</code>와 <code>prod</code>라는 label을 붙여주어 이들을 구분지었습니다.</p><p>그리고 백엔드의 DEV 서버용 CD workflow를 다음과 같이 수정하였습니다.</p><br><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-백엔드-dev용-cd-workflow">🚀 백엔드 DEV용 CD workflow<a href="#-백엔드-dev용-cd-workflow" class="hash-link" aria-label="🚀 백엔드 DEV용 CD workflow에 대한 직접 링크" title="🚀 백엔드 DEV용 CD workflow에 대한 직접 링크">​</a></h4><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ✨ Celuveat backend DEV CD ✨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> develop</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;backend/**&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy-backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dev</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">## 추가</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ✨ Run Backend Deploy Script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cd ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          sudo sh deploy-backend.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><br><br><p>이후 백엔드의 PROD 서버용 CD workflow를 다음과 같이 작성하였습니다.</p><br><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-백엔드-prod용-cd-workflow">🚀 백엔드 PROD용 CD workflow<a href="#-백엔드-prod용-cd-workflow" class="hash-link" aria-label="🚀 백엔드 PROD용 CD workflow에 대한 직접 링크" title="🚀 백엔드 PROD용 CD workflow에 대한 직접 링크">​</a></h4><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ✨ Celuveat backend PROD CD ✨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;backend/**&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy-backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prod</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ✨ Run Backend Deploy Script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cd ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          sudo sh deploy-backend.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><br><br><br><br><br><br><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="-마무리">😎 마무리<a href="#-마무리" class="hash-link" aria-label="😎 마무리에 대한 직접 링크" title="😎 마무리에 대한 직접 링크">​</a></h2><p>이렇게 해서 셀럽잇 팀의 변경된 CI/CD 아키텍처를 살펴보았습니다.</p><p>생각보다 제 블로그로 서브모듈 관련 내용을 넘어가니 정리할 내용이 얼마 없었네요 :)</p><p>읽어주셔서 감사합니다 😊</p><br><br><br></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/ci-cd">CI/CD</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/인프라">인프라</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/github-actions">Github Actions</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/team-blog/back-blog/tags/git-submodules">git submodules</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><a class="pagination-nav__link pagination-nav__link--prev" href="/team-blog/back-blog/royce/submodule/submodule"><div class="pagination-nav__sublabel">이전 게시물</div><div class="pagination-nav__label">Submodule 도입하기</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/team-blog/back-blog/mallang/oauth/oauth"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">OAuth2.0 도입기</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-서론" class="table-of-contents__link toc-highlight">🧐 서론</a></li><li><a href="#-submodule-적용-트러블슈팅" class="table-of-contents__link toc-highlight">🧐 Submodule 적용 트러블슈팅</a><ul><li><a href="#-왜-문제인가" class="table-of-contents__link toc-highlight">🐳 왜 문제인가?</a></li><li><a href="#-어떻게-해결하나요" class="table-of-contents__link toc-highlight">🐳 어떻게 해결하나요?</a></li></ul></li><li><a href="#-개발-서버dev와-프로덕션-서버prod의-배포-자동화하기" class="table-of-contents__link toc-highlight">🧐 개발 서버(Dev)와 프로덕션 서버(Prod)의 배포 자동화하기</a><ul><li><a href="#-runners-의-label-활용하기" class="table-of-contents__link toc-highlight">🐳 Runners 의 Label 활용하기</a></li></ul></li><li><a href="#-마무리" class="table-of-contents__link toc-highlight">😎 마무리</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><span class="footer__link-item">
        Powered by <a href="https://docusaurus.io/" target="_blank" rel="noreferrer noopener">Docusaurus 2</a>, Hosted by <a href="https://github.com/" target="_blank" rel="noreferrer noopener">githubPages</a>
        <br>
        Copyright © 2023 <a href="https://github.com/pumpkiinbell" target="_blank" rel="noreferrer noopener">Celuveat</a>. All rights reserved.
        </span></div></div></div></footer></div>
<script src="/team-blog/assets/js/runtime~main.cdea6afa.js"></script>
<script src="/team-blog/assets/js/main.a6967bef.js"></script>
</body>
</html>